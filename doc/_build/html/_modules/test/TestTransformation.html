<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>test.TestTransformation &mdash; ORMPY 0.1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="ORMPY 0.1 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">ORMPY 0.1 documentation</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for test.TestTransformation</h1><div class="highlight"><pre>
<span class="c">##############################################################################</span>
<span class="c"># Package: ormpy</span>
<span class="c"># File:    TestTransformation.py</span>
<span class="c"># Author:  Matthew Nizol</span>
<span class="c">##############################################################################</span>

<span class="sd">&quot;&quot;&quot; This file contains unit tests for the lib.Transformation module. &quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">unittest</span> <span class="kn">import</span> <span class="n">TestCase</span>

<span class="kn">import</span> <span class="nn">lib.TestDataLocator</span> <span class="kn">as</span> <span class="nn">TestData</span>
<span class="kn">import</span> <span class="nn">lib.Domain</span> <span class="kn">as</span> <span class="nn">Domain</span>
<span class="kn">import</span> <span class="nn">lib.Model</span> <span class="kn">as</span> <span class="nn">Model</span>

<span class="kn">from</span> <span class="nn">lib.FactType</span> <span class="kn">import</span> <span class="n">FactType</span><span class="p">,</span> <span class="n">RoleSequence</span>
<span class="kn">from</span> <span class="nn">lib.ObjectType</span> <span class="kn">import</span> <span class="n">ObjectType</span>
<span class="kn">from</span> <span class="nn">lib.SubtypeGraph</span> <span class="kn">import</span> <span class="n">SubtypeGraph</span>
<span class="kn">from</span> <span class="nn">lib.NormaLoader</span> <span class="kn">import</span> <span class="n">NormaLoader</span>
<span class="kn">from</span> <span class="nn">lib.Constraint</span> <span class="kn">import</span> <span class="n">UniquenessConstraint</span><span class="p">,</span> <span class="n">MandatoryConstraint</span><span class="p">,</span> \
                           <span class="n">FrequencyConstraint</span><span class="p">,</span> <span class="n">SubsetConstraint</span><span class="p">,</span> \
                           <span class="n">EqualityConstraint</span>

<span class="kn">from</span> <span class="nn">lib.Transformation</span> <span class="kn">import</span> <span class="n">Transformation</span><span class="p">,</span> <span class="n">ValueConstraintTransformation</span><span class="p">,</span> \
                               <span class="n">AbsorptionTransformation</span><span class="p">,</span> \
                               <span class="n">DisjunctiveRefTransformation</span><span class="p">,</span> \
                               <span class="n">OverlappingIFCTransformation</span><span class="p">,</span> \
                               <span class="n">EUCStrengtheningTransformation</span><span class="p">,</span> \
                               <span class="n">UnsupportedSubsetRemoval</span><span class="p">,</span> \
                               <span class="n">TupleSubsetTransformation</span><span class="p">,</span> \
                               <span class="n">RootRoleTransformation</span><span class="p">,</span> \
                               <span class="n">JoinMaterialization</span><span class="p">,</span> <span class="n">JoinFactType</span><span class="p">,</span> \
                               <span class="n">direct_subsets</span>

<span class="c">##############################################################################</span>
<span class="c"># Tests for generic Transformation class</span>
<span class="c">##############################################################################</span>
<div class="viewcode-block" id="TestTransformation"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestTransformation">[docs]</a><span class="k">class</span> <span class="nc">TestTransformation</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Tests for generic Transformation class. &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestTransformation.setUp"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestTransformation.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
</div>
<div class="viewcode-block" id="TestTransformation.test_execute_not_implemented"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestTransformation.test_execute_not_implemented">[docs]</a>    <span class="k">def</span> <span class="nf">test_execute_not_implemented</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Confirm execution of execute() raises NotImplementedError. &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">NotImplementedError</span><span class="p">):</span>
            <span class="n">Transformation</span><span class="p">()</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
    
<span class="c">##############################################################################</span>
<span class="c"># ValueConstraintTransformation tests for role value constraints</span>
<span class="c">##############################################################################</span></div></div>
<div class="viewcode-block" id="TestValueConstraintTransformation_RVC"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestValueConstraintTransformation_RVC">[docs]</a><span class="k">class</span> <span class="nc">TestValueConstraintTransformation_RVC</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Unit tests for the ValueConstraintTransformation class that test</span>
<span class="sd">        the handling of role value constraints. &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestValueConstraintTransformation_RVC.setUp"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestValueConstraintTransformation_RVC.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">TestData</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="s">&quot;test_value_type_value_constraint.orm&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">NormaLoader</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span><span class="o">.</span><span class="n">model</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">SubtypeGraph</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>

        <span class="c"># Build dictionaries of model elements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="p">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">obj</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">object_types</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cons</span> <span class="o">=</span> <span class="p">{</span><span class="n">cons</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">cons</span> <span class="k">for</span> <span class="n">cons</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="p">}</span>

        <span class="c"># Transform the model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">ValueConstraintTransformation</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> 
                                                       <span class="n">subtype_graph</span><span class="o">=</span><span class="n">graph</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="TestValueConstraintTransformation_RVC.test_modification_lists_for_value_move"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestValueConstraintTransformation_RVC.test_modification_lists_for_value_move">[docs]</a>    <span class="k">def</span> <span class="nf">test_modification_lists_for_value_move</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Check lists of modified, removed, and added elements. &quot;&quot;&quot;</span>
        <span class="n">removed</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cons</span><span class="p">[</span><span class="s">&quot;RVC_ET3&quot;</span><span class="p">],</span> 
                   <span class="bp">self</span><span class="o">.</span><span class="n">cons</span><span class="p">[</span><span class="s">&quot;RVC_ET4&quot;</span><span class="p">],</span> 
                   <span class="bp">self</span><span class="o">.</span><span class="n">cons</span><span class="p">[</span><span class="s">&quot;RVC_ET5&quot;</span><span class="p">],</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">cons</span><span class="p">[</span><span class="s">&quot;RVC_VT2&quot;</span><span class="p">]]</span>

        <span class="n">modified</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cons</span><span class="p">[</span><span class="s">&quot;RVC_ET1&quot;</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cons</span><span class="p">[</span><span class="s">&quot;RVC_VT1&quot;</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cons</span><span class="p">[</span><span class="s">&quot;RVC_ET6&quot;</span><span class="p">]]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">removed</span><span class="p">,</span> <span class="n">removed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">modified</span><span class="p">,</span> <span class="n">modified</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">added</span><span class="p">,</span> <span class="p">[])</span>

        <span class="c"># Confirm all removed constraints are actually removed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">removed</span><span class="p">),</span> <span class="p">[])</span>

        <span class="c"># Confirm all modified constraints are still in model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="p">),</span> 
                              <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="p">)</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="n">modified</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="TestValueConstraintTransformation_RVC.test_value_cons_already_on_type"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestValueConstraintTransformation_RVC.test_value_cons_already_on_type">[docs]</a>    <span class="k">def</span> <span class="nf">test_value_cons_already_on_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Test case where value constraint is already on the value type. &quot;&quot;&quot;</span>

        <span class="c"># Value type A        </span>
        <span class="n">vt_a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="s">&quot;A&quot;</span><span class="p">]</span>
        <span class="n">vc_a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cons</span><span class="p">[</span><span class="s">&quot;VC_A&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">vt_a</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="mi">15</span><span class="p">),</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span> <span class="o">+</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="mi">101</span><span class="p">,</span><span class="mi">102</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">vc_a</span><span class="o">.</span><span class="n">covers</span><span class="p">,</span> <span class="p">[</span><span class="n">vt_a</span><span class="p">])</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">vt_a</span><span class="o">.</span><span class="n">covered_by</span><span class="p">,</span> <span class="p">[</span><span class="n">vc_a</span><span class="p">])</span>        

        <span class="c"># Value type ET2_id </span>
        <span class="n">et2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="s">&quot;ET2&quot;</span><span class="p">]</span>
        <span class="n">et2_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="s">&quot;ET2_id&quot;</span><span class="p">]</span>
        <span class="n">vc_et2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cons</span><span class="p">[</span><span class="s">&quot;VC_ET2&quot;</span><span class="p">]</span>      
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">et2</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="p">[</span><span class="s">&quot;ET2_0&quot;</span><span class="p">,</span> <span class="s">&quot;ET2_1&quot;</span><span class="p">,</span> <span class="s">&quot;ET2_2&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">et2_id</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">vc_et2</span><span class="o">.</span><span class="n">covers</span><span class="p">,</span> <span class="p">[</span><span class="n">et2_id</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">et2_id</span><span class="o">.</span><span class="n">covered_by</span><span class="p">,</span> <span class="p">[</span><span class="n">vc_et2</span><span class="p">])</span>
       
</div>
<div class="viewcode-block" id="TestValueConstraintTransformation_RVC.test_basic_entity_type_move"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestValueConstraintTransformation_RVC.test_basic_entity_type_move">[docs]</a>    <span class="k">def</span> <span class="nf">test_basic_entity_type_move</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Test basic move of value constraint on entity type from identifying</span>
<span class="sd">            role to identifying value type. &quot;&quot;&quot;</span>

        <span class="n">et1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="s">&quot;ET1&quot;</span><span class="p">]</span>
        <span class="n">et1_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="s">&quot;ET1_id&quot;</span><span class="p">]</span>
        <span class="n">rvc_et1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cons</span><span class="p">[</span><span class="s">&quot;RVC_ET1&quot;</span><span class="p">]</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">et1</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="p">[</span><span class="s">&quot;ET1_0&quot;</span><span class="p">,</span> <span class="s">&quot;ET1_1&quot;</span><span class="p">,</span> <span class="s">&quot;ET1_2&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">et1_id</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">rvc_et1</span><span class="o">.</span><span class="n">covers</span><span class="p">,</span> <span class="p">[</span><span class="n">et1_id</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">et1_id</span><span class="o">.</span><span class="n">covered_by</span><span class="p">,</span> <span class="p">[</span><span class="n">rvc_et1</span><span class="p">])</span> 

</div>
<div class="viewcode-block" id="TestValueConstraintTransformation_RVC.test_failed_move_due_to_shared_ref_mode"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestValueConstraintTransformation_RVC.test_failed_move_due_to_shared_ref_mode">[docs]</a>    <span class="k">def</span> <span class="nf">test_failed_move_due_to_shared_ref_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Test case where we cannot move the value constraint to the </span>
<span class="sd">            identifying value type because that type plays more than one role.&quot;&quot;&quot;</span>

        <span class="n">et3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="s">&quot;ET3&quot;</span><span class="p">]</span>
        <span class="n">et4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="s">&quot;ET4&quot;</span><span class="p">]</span>
        <span class="n">usd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="s">&quot;USDValue&quot;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">et3</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="p">[</span><span class="s">&quot;ET3_0&quot;</span><span class="p">,</span> <span class="s">&quot;ET3_1&quot;</span><span class="p">,</span> <span class="s">&quot;ET3_2&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">et4</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="p">[</span><span class="s">&quot;ET4_0&quot;</span><span class="p">,</span> <span class="s">&quot;ET4_1&quot;</span><span class="p">,</span> <span class="s">&quot;ET4_2&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">usd</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])</span>

        <span class="n">rvc_et3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cons</span><span class="p">[</span><span class="s">&quot;RVC_ET3&quot;</span><span class="p">]</span>
        <span class="n">rvc_et4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cons</span><span class="p">[</span><span class="s">&quot;RVC_ET4&quot;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">rvc_et3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">removed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">rvc_et4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">removed</span><span class="p">)</span>
        
        <span class="n">role3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;ET3HasUSDValue&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">role4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;ET4HasUSDValue&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">usd</span><span class="o">.</span><span class="n">covered_by</span><span class="p">,</span> <span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="n">rvc_et3</span><span class="p">,</span> <span class="n">role3</span><span class="o">.</span><span class="n">covered_by</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="n">rvc_et4</span><span class="p">,</span> <span class="n">role4</span><span class="o">.</span><span class="n">covered_by</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="TestValueConstraintTransformation_RVC.test_failed_move_due_to_entity_with_mult_roles"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestValueConstraintTransformation_RVC.test_failed_move_due_to_entity_with_mult_roles">[docs]</a>    <span class="k">def</span> <span class="nf">test_failed_move_due_to_entity_with_mult_roles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Test case where we cannot move RVC because the entity type plays</span>
<span class="sd">            more than one role. &quot;&quot;&quot;</span>

        <span class="n">et5</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="s">&quot;ET5&quot;</span><span class="p">]</span>
        <span class="n">et5_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="s">&quot;ET5_Id&quot;</span><span class="p">]</span>
        <span class="n">rvc_et5</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cons</span><span class="p">[</span><span class="s">&quot;RVC_ET5&quot;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">et5</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="p">[</span><span class="s">&quot;ET5_0&quot;</span><span class="p">,</span> <span class="s">&quot;ET5_1&quot;</span><span class="p">,</span> <span class="s">&quot;ET5_2&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">et5_id</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">rvc_et5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">removed</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">et5</span><span class="o">.</span><span class="n">covered_by</span><span class="p">,</span> <span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">et5_id</span><span class="o">.</span><span class="n">covered_by</span><span class="p">,</span> <span class="p">[])</span>

        <span class="n">role</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;ET5Exists&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="n">rvc_et5</span><span class="p">,</span> <span class="n">role</span><span class="o">.</span><span class="n">covered_by</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestValueConstraintTransformation_RVC.test_move_of_rvc_to_non_ref_value_type"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestValueConstraintTransformation_RVC.test_move_of_rvc_to_non_ref_value_type">[docs]</a>    <span class="k">def</span> <span class="nf">test_move_of_rvc_to_non_ref_value_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Test move of rvc to non-referential value type. &quot;&quot;&quot;</span>

        <span class="c"># VT1 plays only a unary role and is not independent, so the role </span>
        <span class="c"># value constraint can cover the object type instead.</span>
        <span class="n">vt1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="s">&quot;VT1&quot;</span><span class="p">]</span>
        <span class="n">rvc_vt1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cons</span><span class="p">[</span><span class="s">&quot;RVC_VT1&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">vt1</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="mi">45</span><span class="p">,</span><span class="mi">71</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">rvc_vt1</span><span class="o">.</span><span class="n">covers</span><span class="p">,</span> <span class="p">[</span><span class="n">vt1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">vt1</span><span class="o">.</span><span class="n">covered_by</span><span class="p">,</span> <span class="p">[</span><span class="n">rvc_vt1</span><span class="p">])</span>  
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">rvc_vt1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">modified</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestValueConstraintTransformation_RVC.test_failed_move_due_to_independence"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestValueConstraintTransformation_RVC.test_failed_move_due_to_independence">[docs]</a>    <span class="k">def</span> <span class="nf">test_failed_move_due_to_independence</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Test failure to move rvc due to value type independence. &quot;&quot;&quot;</span>

        <span class="n">vt2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="s">&quot;VT2&quot;</span><span class="p">]</span>
        <span class="n">rvc_vt2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cons</span><span class="p">[</span><span class="s">&quot;RVC_VT2&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">vt2</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">vt2</span><span class="o">.</span><span class="n">covered_by</span><span class="p">,</span> <span class="p">[])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">rvc_vt2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">removed</span><span class="p">)</span>

        <span class="n">role</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;VT2Exists&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="n">rvc_vt2</span><span class="p">,</span> <span class="n">role</span><span class="o">.</span><span class="n">covered_by</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestValueConstraintTransformation_RVC.test_intersection_of_value_constraints"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestValueConstraintTransformation_RVC.test_intersection_of_value_constraints">[docs]</a>    <span class="k">def</span> <span class="nf">test_intersection_of_value_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Test case where RVC can be moved but value type already is covered</span>
<span class="sd">            by another value constraint. &quot;&quot;&quot;</span>

        <span class="n">et6</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="s">&quot;ET6&quot;</span><span class="p">]</span>
        <span class="n">et6_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="s">&quot;ET6_id&quot;</span><span class="p">]</span>
        <span class="n">rvc_et6</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cons</span><span class="p">[</span><span class="s">&quot;RVC_ET6&quot;</span><span class="p">]</span>
        <span class="n">vc_et6</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cons</span><span class="p">[</span><span class="s">&quot;VC_ET6&quot;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">et6</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="p">[</span><span class="s">&quot;ET6_0&quot;</span><span class="p">,</span><span class="s">&quot;ET6_1&quot;</span><span class="p">,</span><span class="s">&quot;ET6_2&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">et6_id</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">et6_id</span><span class="o">.</span><span class="n">covered_by</span><span class="p">,</span> <span class="p">[</span><span class="n">rvc_et6</span><span class="p">,</span> <span class="n">vc_et6</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">rvc_et6</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">modified</span><span class="p">)</span>

<span class="c">##############################################################################</span>
<span class="c"># ValueConstraintTransformation class tests for subtypes</span>
<span class="c">##############################################################################</span></div></div>
<div class="viewcode-block" id="TestValueConstraintTransformation_Subtypes"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestValueConstraintTransformation_Subtypes">[docs]</a><span class="k">class</span> <span class="nc">TestValueConstraintTransformation_Subtypes</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Unit tests for the ValueConstraintTransformation class that test</span>
<span class="sd">        the handling of subtype value constraints. &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestValueConstraintTransformation_Subtypes.setUp"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestValueConstraintTransformation_Subtypes.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxDiff</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="n">fname</span> <span class="o">=</span> <span class="n">TestData</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="s">&quot;value_constraints_on_subtypes.orm&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">NormaLoader</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span><span class="o">.</span><span class="n">model</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">SubtypeGraph</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>

        <span class="c"># Build dictionaries of model elements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="p">{</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">obj</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">object_types</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cons</span> <span class="o">=</span> <span class="p">{</span><span class="n">cons</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">cons</span> <span class="k">for</span> <span class="n">cons</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="p">}</span>

        <span class="c"># Transform the model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">ValueConstraintTransformation</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> 
                                                       <span class="n">subtype_graph</span><span class="o">=</span><span class="n">graph</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="TestValueConstraintTransformation_Subtypes.test_contents_of_modification_lists"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestValueConstraintTransformation_Subtypes.test_contents_of_modification_lists">[docs]</a>    <span class="k">def</span> <span class="nf">test_contents_of_modification_lists</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Test contents of modified, removed, added lists. &quot;&quot;&quot;</span>
        <span class="n">removed</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cons</span><span class="p">[</span><span class="s">&quot;VC_R&quot;</span><span class="p">],</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">cons</span><span class="p">[</span><span class="s">&quot;VC_S&quot;</span><span class="p">],</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">cons</span><span class="p">[</span><span class="s">&quot;VC_F&quot;</span><span class="p">]]</span>
        <span class="n">modified</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cons</span><span class="p">[</span><span class="s">&quot;VC_I&quot;</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cons</span><span class="p">[</span><span class="s">&quot;VC_K&quot;</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cons</span><span class="p">[</span><span class="s">&quot;VC_P&quot;</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cons</span><span class="p">[</span><span class="s">&quot;VC_Q&quot;</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cons</span><span class="p">[</span><span class="s">&quot;VC_W&quot;</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cons</span><span class="p">[</span><span class="s">&quot;VC_Z&quot;</span><span class="p">]]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">added</span><span class="p">,</span> <span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">removed</span><span class="p">,</span> <span class="n">removed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">modified</span><span class="p">,</span> <span class="n">modified</span><span class="p">)</span>

        <span class="c"># Confirm all removed constraints are actually removed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">removed</span><span class="p">),</span> <span class="p">[])</span>

        <span class="c"># Confirm all modified constraints are still in model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="p">),</span> 
                              <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="p">)</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="n">modified</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestValueConstraintTransformation_Subtypes.test_subtype_with_only_root_constraint"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestValueConstraintTransformation_Subtypes.test_subtype_with_only_root_constraint">[docs]</a>    <span class="k">def</span> <span class="nf">test_subtype_with_only_root_constraint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Test case where the only element with a value constraint</span>
<span class="sd">            is the root. &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="s">&quot;A&quot;</span><span class="p">]</span>
        <span class="n">vc_a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cons</span><span class="p">[</span><span class="s">&quot;VC_A&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">61</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span> <span class="n">vc_a</span><span class="o">.</span><span class="n">domain</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">vc_a</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">covered_by</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestValueConstraintTransformation_Subtypes.test_subtype_with_one_subtype_value_constraint"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestValueConstraintTransformation_Subtypes.test_subtype_with_one_subtype_value_constraint">[docs]</a>    <span class="k">def</span> <span class="nf">test_subtype_with_one_subtype_value_constraint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Test case where only one subtype has a value constraint. &quot;&quot;&quot;</span>
        <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="s">&quot;I&quot;</span><span class="p">]</span>
        <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="s">&quot;K&quot;</span><span class="p">]</span>
        <span class="n">vc_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cons</span><span class="p">[</span><span class="s">&quot;VC_I&quot;</span><span class="p">]</span>
        <span class="n">vc_k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cons</span><span class="p">[</span><span class="s">&quot;VC_K&quot;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">51</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">41</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span> <span class="n">vc_i</span><span class="o">.</span><span class="n">domain</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span> <span class="n">vc_k</span><span class="o">.</span><span class="n">domain</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">vc_i</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">covered_by</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">vc_k</span><span class="p">,</span> <span class="n">k</span><span class="o">.</span><span class="n">covered_by</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestValueConstraintTransformation_Subtypes.test_deletion_of_extra_value_constraints"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestValueConstraintTransformation_Subtypes.test_deletion_of_extra_value_constraints">[docs]</a>    <span class="k">def</span> <span class="nf">test_deletion_of_extra_value_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Confirm that only one value constraint is kept per subtype graph</span>
<span class="sd">            (not counting the root).&quot;&quot;&quot;</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="s">&quot;P&quot;</span><span class="p">]</span>
        <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="s">&quot;Q&quot;</span><span class="p">]</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="s">&quot;R&quot;</span><span class="p">]</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="s">&quot;S&quot;</span><span class="p">]</span>
        <span class="n">vc_p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cons</span><span class="p">[</span><span class="s">&quot;VC_P&quot;</span><span class="p">]</span>
        <span class="n">vc_q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cons</span><span class="p">[</span><span class="s">&quot;VC_Q&quot;</span><span class="p">]</span>
        <span class="n">vc_r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cons</span><span class="p">[</span><span class="s">&quot;VC_R&quot;</span><span class="p">]</span>
        <span class="n">vc_s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cons</span><span class="p">[</span><span class="s">&quot;VC_S&quot;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span> <span class="n">vc_p</span><span class="o">.</span><span class="n">domain</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">vc_p</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">covered_by</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span> <span class="n">vc_q</span><span class="o">.</span><span class="n">domain</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">vc_q</span><span class="p">,</span> <span class="n">q</span><span class="o">.</span><span class="n">covered_by</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEquals</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span> <span class="n">vc_r</span><span class="o">.</span><span class="n">domain</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">covered_by</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cons</span><span class="p">[</span><span class="s">&quot;RIsASubtypeOfQ&quot;</span><span class="p">]])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEquals</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span> <span class="n">vc_s</span><span class="o">.</span><span class="n">domain</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">covered_by</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cons</span><span class="p">[</span><span class="s">&quot;SIsASubtypeOfQ&quot;</span><span class="p">]])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span> <span class="n">Domain</span><span class="o">.</span><span class="n">IntegerDomain</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span> <span class="n">Domain</span><span class="o">.</span><span class="n">IntegerDomain</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestValueConstraintTransformation_Subtypes.test_deletion_of_value_cons_when_root_has_no_vc"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestValueConstraintTransformation_Subtypes.test_deletion_of_value_cons_when_root_has_no_vc">[docs]</a>    <span class="k">def</span> <span class="nf">test_deletion_of_value_cons_when_root_has_no_vc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Test when root has no value constraint but subtype does. &quot;&quot;&quot;</span>
        <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="s">&quot;E&quot;</span><span class="p">]</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="s">&quot;F&quot;</span><span class="p">]</span>
        <span class="n">vc_f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cons</span><span class="p">[</span><span class="s">&quot;VC_F&quot;</span><span class="p">]</span>
        <span class="n">sub_cons</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cons</span><span class="p">[</span><span class="s">&quot;FIsASubtypeOfE&quot;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span> <span class="n">Domain</span><span class="o">.</span><span class="n">IntegerDomain</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">covered_by</span><span class="p">,</span> <span class="p">[</span><span class="n">sub_cons</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEquals</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span> <span class="n">vc_f</span><span class="o">.</span><span class="n">domain</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span> <span class="n">Domain</span><span class="o">.</span><span class="n">IntegerDomain</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">covered_by</span><span class="p">,</span> <span class="p">[</span><span class="n">sub_cons</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="TestValueConstraintTransformation_Subtypes.test_intersection_and_reordering_of_value_constraints"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestValueConstraintTransformation_Subtypes.test_intersection_and_reordering_of_value_constraints">[docs]</a>    <span class="k">def</span> <span class="nf">test_intersection_and_reordering_of_value_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Confirm that subtype value constraint is forced to be a subset of</span>
<span class="sd">            the root, and that the root&#39;s value constraint is reordered so that</span>
<span class="sd">            the subtype&#39;s elements come first. &quot;&quot;&quot;</span>

        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="s">&quot;W&quot;</span><span class="p">]</span>
        <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="s">&quot;Z&quot;</span><span class="p">]</span>

        <span class="n">vc_w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cons</span><span class="p">[</span><span class="s">&quot;VC_W&quot;</span><span class="p">]</span>
        <span class="n">vc_z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cons</span><span class="p">[</span><span class="s">&quot;VC_Z&quot;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span> <span class="n">vc_w</span><span class="o">.</span><span class="n">domain</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span> <span class="n">vc_z</span><span class="o">.</span><span class="n">domain</span><span class="p">)</span>

        <span class="c"># Use assert equals to check order</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="mi">22</span><span class="p">]</span> <span class="o">+</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="mi">22</span><span class="p">])</span>

<span class="c">##############################################################################</span>
<span class="c"># AbsorptionTransformation tests</span>
<span class="c">##############################################################################</span></div></div>
<div class="viewcode-block" id="TestAbsorptionTransformation"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestAbsorptionTransformation">[docs]</a><span class="k">class</span> <span class="nc">TestAbsorptionTransformation</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Unit tests for the AbsorptionTransformation class. &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestAbsorptionTransformation.setUp"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestAbsorptionTransformation.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxDiff</span> <span class="o">=</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="TestAbsorptionTransformation.test_pattern_not_matched"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestAbsorptionTransformation.test_pattern_not_matched">[docs]</a>    <span class="k">def</span> <span class="nf">test_pattern_not_matched</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Test that EUCs which don&#39;t match the pattern are ignored.&quot;&quot;&quot;</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">TestData</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="s">&quot;absorption_no_matching_euc.orm&quot;</span><span class="p">)</span>
        <span class="n">loader</span> <span class="o">=</span> <span class="n">NormaLoader</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">model</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">loader</span><span class="o">.</span><span class="n">omissions</span><span class="p">,</span> <span class="p">[])</span>

        <span class="c"># EUCs before transformation</span>
        <span class="n">eucs</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">internal</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="n">UniquenessConstraint</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">eucs</span><span class="p">),</span> <span class="mi">8</span><span class="p">)</span>

        <span class="n">trans</span> <span class="o">=</span> <span class="n">AbsorptionTransformation</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="n">trans</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

        <span class="c"># Same number of EUCs after transformation</span>
        <span class="n">eucs</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">internal</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="n">UniquenessConstraint</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">eucs</span><span class="p">),</span> <span class="mi">8</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">added</span><span class="p">,</span> <span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">removed</span><span class="p">,</span> <span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">modified</span><span class="p">,</span> <span class="p">[])</span>
</div>
<div class="viewcode-block" id="TestAbsorptionTransformation.test_simple_absorption"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestAbsorptionTransformation.test_simple_absorption">[docs]</a>    <span class="k">def</span> <span class="nf">test_simple_absorption</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Test simple absorption transformation. &quot;&quot;&quot;</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">TestData</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="s">&quot;absorption_valid_simple.orm&quot;</span><span class="p">)</span>
        <span class="n">loader</span> <span class="o">=</span> <span class="n">NormaLoader</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">model</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">loader</span><span class="o">.</span><span class="n">omissions</span><span class="p">,</span> <span class="p">[])</span>

        <span class="c"># Before transformation</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">object_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">object_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;B&quot;</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">object_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;C&quot;</span><span class="p">)</span>
        <span class="n">euc</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;EUC1&quot;</span><span class="p">)</span>
        <span class="n">AHasB</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;AHasB&quot;</span><span class="p">)</span>
        <span class="n">AHasC</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;AHasC&quot;</span><span class="p">)</span>
        <span class="n">old_cons</span> <span class="o">=</span> <span class="p">[</span><span class="n">cons</span> <span class="k">for</span> <span class="n">cons</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">euc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">AHasB</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">AHasC</span><span class="p">)</span>

        <span class="c"># Transformation</span>
        <span class="n">trans</span> <span class="o">=</span> <span class="n">AbsorptionTransformation</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="n">trans</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

        <span class="c"># After transformation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;EUC1&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;AHasB&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;AHasC&quot;</span><span class="p">))</span>

        <span class="c"># Constraint count of 3: 1 mandatory, 2 IUC</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
        
        <span class="n">absorb_fact</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;EUC1&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">absorb_fact</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">absorb_fact</span><span class="o">.</span><span class="n">arity</span><span class="p">(),</span> <span class="mi">3</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">absorb_fact</span><span class="o">.</span><span class="n">root_role</span><span class="o">.</span><span class="n">player</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>

        <span class="n">role0</span> <span class="o">=</span> <span class="n">absorb_fact</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">role0</span><span class="o">.</span><span class="n">player</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">role0</span><span class="o">.</span><span class="n">covered_by</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">role0</span><span class="o">.</span><span class="n">covered_by</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">UniquenessConstraint</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">role0</span><span class="o">.</span><span class="n">covered_by</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">covers</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">role0</span><span class="o">.</span><span class="n">covered_by</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">MandatoryConstraint</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">role0</span><span class="o">.</span><span class="n">covered_by</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">simple</span><span class="p">)</span>

        <span class="n">role1</span> <span class="o">=</span> <span class="n">absorb_fact</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">role2</span> <span class="o">=</span> <span class="n">absorb_fact</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">role1</span><span class="o">.</span><span class="n">player</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">role2</span><span class="o">.</span><span class="n">player</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">role1</span><span class="o">.</span><span class="n">covered_by</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">role2</span><span class="o">.</span><span class="n">covered_by</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">role1</span><span class="o">.</span><span class="n">covered_by</span><span class="p">,</span> <span class="n">role2</span><span class="o">.</span><span class="n">covered_by</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">role1</span><span class="o">.</span><span class="n">covered_by</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">UniquenessConstraint</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">role1</span><span class="o">.</span><span class="n">covered_by</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">role2</span><span class="o">.</span><span class="n">covered_by</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="c"># Check ref roles</span>
        <span class="n">idcons</span> <span class="o">=</span> <span class="n">role1</span><span class="o">.</span><span class="n">covered_by</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">identifying_constraint</span><span class="p">,</span> <span class="n">idcons</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">idcons</span><span class="o">.</span><span class="n">identifier_for</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">ref_roles</span><span class="p">,</span> <span class="p">[</span><span class="n">role0</span><span class="p">])</span>

        <span class="c"># Check absorb_fact.fact_type_names</span>
        <span class="n">expected</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;B&#39;</span><span class="p">:</span> <span class="s">&quot;FactTypes.AHasB&quot;</span><span class="p">,</span> <span class="s">&#39;C&#39;</span><span class="p">:</span> <span class="s">&quot;FactTypes.AHasC&quot;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertDictEqual</span><span class="p">(</span><span class="n">absorb_fact</span><span class="o">.</span><span class="n">fact_type_names</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span>

        <span class="c"># Check contents of added, removed, modified</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">added</span><span class="p">,</span> <span class="p">[</span><span class="n">absorb_fact</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">removed</span><span class="p">,</span> <span class="p">[</span><span class="n">AHasB</span><span class="p">,</span> <span class="n">AHasC</span><span class="p">]</span> <span class="o">+</span> <span class="n">old_cons</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">modified</span><span class="p">,</span> <span class="p">[])</span>
        </div>
<div class="viewcode-block" id="TestAbsorptionTransformation.test_four_part_absorption"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestAbsorptionTransformation.test_four_part_absorption">[docs]</a>    <span class="k">def</span> <span class="nf">test_four_part_absorption</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Test absorption transformation involving four fact types. &quot;&quot;&quot;</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">TestData</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="s">&quot;absorption_valid_four_facts.orm&quot;</span><span class="p">)</span>
        <span class="n">loader</span> <span class="o">=</span> <span class="n">NormaLoader</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">model</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">loader</span><span class="o">.</span><span class="n">omissions</span><span class="p">,</span> <span class="p">[])</span>

        <span class="c"># Before transformation</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">object_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">object_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;B&quot;</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">object_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;C&quot;</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">object_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;D&quot;</span><span class="p">)</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">object_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;E&quot;</span><span class="p">)</span>
        <span class="n">old_fact</span> <span class="o">=</span> <span class="p">[</span><span class="n">fact</span> <span class="k">for</span> <span class="n">fact</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="p">]</span>
        <span class="n">old_cons</span> <span class="o">=</span> <span class="p">[</span><span class="n">cons</span> <span class="k">for</span> <span class="n">cons</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="p">]</span>

        <span class="c"># Transformation</span>
        <span class="n">trans</span> <span class="o">=</span> <span class="n">AbsorptionTransformation</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="n">trans</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

        <span class="c"># After transformation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
        
        <span class="n">absorb_fact</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;EUC1&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">absorb_fact</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">absorb_fact</span><span class="o">.</span><span class="n">arity</span><span class="p">(),</span> <span class="mi">5</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">absorb_fact</span><span class="o">.</span><span class="n">root_role</span><span class="o">.</span><span class="n">player</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>

        <span class="n">role0</span> <span class="o">=</span> <span class="n">absorb_fact</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">role0</span><span class="o">.</span><span class="n">player</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">role0</span><span class="o">.</span><span class="n">covered_by</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">role0</span><span class="o">.</span><span class="n">covered_by</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">UniquenessConstraint</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">role0</span><span class="o">.</span><span class="n">covered_by</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">covers</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">role0</span><span class="o">.</span><span class="n">covered_by</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">MandatoryConstraint</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">role0</span><span class="o">.</span><span class="n">covered_by</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">simple</span><span class="p">)</span>

        <span class="n">role1</span> <span class="o">=</span> <span class="n">absorb_fact</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">role2</span> <span class="o">=</span> <span class="n">absorb_fact</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">role3</span> <span class="o">=</span> <span class="n">absorb_fact</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">role4</span> <span class="o">=</span> <span class="n">absorb_fact</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">role1</span><span class="o">.</span><span class="n">player</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">role2</span><span class="o">.</span><span class="n">player</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">role3</span><span class="o">.</span><span class="n">player</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">role4</span><span class="o">.</span><span class="n">player</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">role1</span><span class="o">.</span><span class="n">covered_by</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">role1</span><span class="o">.</span><span class="n">covered_by</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">MandatoryConstraint</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">role1</span><span class="o">.</span><span class="n">covered_by</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">simple</span><span class="p">)</span>

        <span class="n">uniq</span> <span class="o">=</span> <span class="n">role1</span><span class="o">.</span><span class="n">covered_by</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uniq</span><span class="o">.</span><span class="n">covers</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">uniq</span><span class="p">,</span> <span class="n">UniquenessConstraint</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">role2</span><span class="o">.</span><span class="n">covered_by</span><span class="p">,</span> <span class="p">[</span><span class="n">uniq</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">role3</span><span class="o">.</span><span class="n">covered_by</span><span class="p">,</span> <span class="p">[</span><span class="n">uniq</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">role4</span><span class="o">.</span><span class="n">covered_by</span><span class="p">,</span> <span class="p">[</span><span class="n">uniq</span><span class="p">])</span>  

        <span class="c"># Confirm that new uniqueness constraint is the identifier for &quot;A&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">identifying_constraint</span><span class="p">,</span> <span class="n">uniq</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">uniq</span><span class="o">.</span><span class="n">identifier_for</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">ref_roles</span><span class="p">,</span> <span class="p">[</span><span class="n">role0</span><span class="p">])</span>      
        
        <span class="c"># Check absorb_fact.fact_type_names</span>
        <span class="n">expected</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;B&#39;</span><span class="p">:</span><span class="s">&quot;FactTypes.AHasB&quot;</span><span class="p">,</span> <span class="s">&#39;C&#39;</span><span class="p">:</span><span class="s">&quot;FactTypes.AHasC&quot;</span><span class="p">,</span> <span class="s">&#39;D&#39;</span><span class="p">:</span><span class="s">&quot;FactTypes.AHasD&quot;</span><span class="p">,</span> <span class="s">&#39;E&#39;</span><span class="p">:</span><span class="s">&quot;FactTypes.AHasE&quot;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertDictEqual</span><span class="p">(</span><span class="n">absorb_fact</span><span class="o">.</span><span class="n">fact_type_names</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span>

        <span class="c"># Check contents of added, removed, modified</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">added</span><span class="p">,</span> <span class="p">[</span><span class="n">absorb_fact</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">removed</span><span class="p">,</span> <span class="n">old_fact</span> <span class="o">+</span> <span class="n">old_cons</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">modified</span><span class="p">,</span> <span class="p">[])</span>

<span class="c">##############################################################################</span>
<span class="c"># DisjunctiveRefTransformation tests</span>
<span class="c">##############################################################################</span></div></div>
<div class="viewcode-block" id="TestDisjunctiveRefTransformation"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestDisjunctiveRefTransformation">[docs]</a><span class="k">class</span> <span class="nc">TestDisjunctiveRefTransformation</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Unit tests for the DisjunctiveRefTransformation class. &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestDisjunctiveRefTransformation.setUp"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestDisjunctiveRefTransformation.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxDiff</span> <span class="o">=</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="TestDisjunctiveRefTransformation.test_disjunctive_ref_no_ior"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestDisjunctiveRefTransformation.test_disjunctive_ref_no_ior">[docs]</a>    <span class="k">def</span> <span class="nf">test_disjunctive_ref_no_ior</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Test a disjunctive reference scheme with no IOR constraint. &quot;&quot;&quot;</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">TestData</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="s">&quot;disjunctive_reference_scheme.orm&quot;</span><span class="p">)</span>
        <span class="n">loader</span> <span class="o">=</span> <span class="n">NormaLoader</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">model</span>

        <span class="n">mand</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="n">MandatoryConstraint</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mand</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">object_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">)</span>
        <span class="n">role1</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;AHasB&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">role2</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;AHasC&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">ref_roles</span><span class="p">,</span> <span class="p">[</span><span class="n">role1</span><span class="p">,</span> <span class="n">role2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">role1</span><span class="o">.</span><span class="n">mandatory</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">role2</span><span class="o">.</span><span class="n">mandatory</span><span class="p">)</span>
    
        <span class="c"># Execute the transformation</span>
        <span class="n">trans</span> <span class="o">=</span> <span class="n">DisjunctiveRefTransformation</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">execute</span><span class="p">())</span>

        <span class="n">mand</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="n">MandatoryConstraint</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mand</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c"># Both ref roles now mandatory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">role1</span><span class="o">.</span><span class="n">mandatory</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">role2</span><span class="o">.</span><span class="n">mandatory</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestDisjunctiveRefTransformation.test_disjunctive_ref_with_ior"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestDisjunctiveRefTransformation.test_disjunctive_ref_with_ior">[docs]</a>    <span class="k">def</span> <span class="nf">test_disjunctive_ref_with_ior</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Test a disjunctive reference scheme WITH an IOR constraint. &quot;&quot;&quot;</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">TestData</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="s">&quot;disjunctive_reference_scheme_2.orm&quot;</span><span class="p">)</span>
        <span class="n">loader</span> <span class="o">=</span> <span class="n">NormaLoader</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">model</span>

        <span class="n">mand</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="n">MandatoryConstraint</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mand</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">mand</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">simple</span><span class="p">)</span> <span class="c"># IOR constraint</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">object_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">)</span>
        <span class="n">role1</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;AHasB&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">role2</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;AHasC&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">ref_roles</span><span class="p">,</span> <span class="p">[</span><span class="n">role1</span><span class="p">,</span> <span class="n">role2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">role1</span><span class="o">.</span><span class="n">mandatory</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">role2</span><span class="o">.</span><span class="n">mandatory</span><span class="p">)</span>
    
        <span class="c"># Execute the transformation</span>
        <span class="n">trans</span> <span class="o">=</span> <span class="n">DisjunctiveRefTransformation</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">execute</span><span class="p">())</span>

        <span class="n">mand</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="n">MandatoryConstraint</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mand</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">mand</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">simple</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">mand</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">simple</span><span class="p">)</span>

        <span class="c"># Both ref roles now mandatory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">role1</span><span class="o">.</span><span class="n">mandatory</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">role2</span><span class="o">.</span><span class="n">mandatory</span><span class="p">)</span>

<span class="c">##############################################################################</span>
<span class="c"># OverlappingIFCTransformation tests</span>
<span class="c">##############################################################################</span></div></div>
<div class="viewcode-block" id="TestOverlappingIFCTransformation"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestOverlappingIFCTransformation">[docs]</a><span class="k">class</span> <span class="nc">TestOverlappingIFCTransformation</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Unit tests for the OverlappingIFCTransformation class. &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestOverlappingIFCTransformation.setUp"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestOverlappingIFCTransformation.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxDiff</span> <span class="o">=</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="TestOverlappingIFCTransformation.test_non_overlapping"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestOverlappingIFCTransformation.test_non_overlapping">[docs]</a>    <span class="k">def</span> <span class="nf">test_non_overlapping</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Test case where IUCs don&#39;t overlap. &quot;&quot;&quot;</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">TestData</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="s">&quot;uniqueness_constraints.orm&quot;</span><span class="p">)</span>
        <span class="n">loader</span> <span class="o">=</span> <span class="n">NormaLoader</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">model</span> 

        <span class="n">get</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;InternalUniquenessConstraint5&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">covers</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;InternalUniquenessConstraint1&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">covers</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;InternalUniquenessConstraint4&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">covers</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;InternalUniquenessConstraint9&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">covers</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;InternalUniquenessConstraint10&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">covers</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c"># Run transformation and confirm return value is false</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">OverlappingIFCTransformation</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">())</span>

        <span class="c"># Assert that nothing changed.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;InternalUniquenessConstraint5&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">covers</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;InternalUniquenessConstraint1&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">covers</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;InternalUniquenessConstraint4&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">covers</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;InternalUniquenessConstraint9&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">covers</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;InternalUniquenessConstraint10&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">covers</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestOverlappingIFCTransformation.test_overlap_but_cannot_transform"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestOverlappingIFCTransformation.test_overlap_but_cannot_transform">[docs]</a>    <span class="k">def</span> <span class="nf">test_overlap_but_cannot_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Test case where there is overlap but due to properties of the </span>
<span class="sd">            constraints we can&#39;t transform them. &quot;&quot;&quot;</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">TestData</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="s">&quot;overlapping_iuc_no_transform.orm&quot;</span><span class="p">)</span>
        <span class="n">loader</span> <span class="o">=</span> <span class="n">NormaLoader</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">model</span> 
        <span class="n">get</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span>

        <span class="n">old_cons</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="n">FrequencyConstraint</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">old_cons</span><span class="p">),</span> <span class="mi">6</span><span class="p">)</span>

        <span class="c"># Run transformation and confirm return value is false</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">OverlappingIFCTransformation</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">())</span>

        <span class="c"># Confirm nothing changed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">old_cons</span><span class="p">),</span> <span class="mi">6</span><span class="p">)</span>

        <span class="n">fc1</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="s">&quot;FC1&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">fc1</span><span class="o">.</span><span class="n">min_freq</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">fc1</span><span class="o">.</span><span class="n">max_freq</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fc1</span><span class="o">.</span><span class="n">covers</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>

        <span class="n">fc2</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="s">&quot;FC2&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">fc2</span><span class="o">.</span><span class="n">min_freq</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">fc2</span><span class="o">.</span><span class="n">max_freq</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fc2</span><span class="o">.</span><span class="n">covers</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>

        <span class="n">fc3</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="s">&quot;FC3&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">fc3</span><span class="o">.</span><span class="n">min_freq</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">fc3</span><span class="o">.</span><span class="n">max_freq</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fc3</span><span class="o">.</span><span class="n">covers</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;IUC1&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">covers</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">fc4</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="s">&quot;FC4&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">fc4</span><span class="o">.</span><span class="n">min_freq</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">fc4</span><span class="o">.</span><span class="n">max_freq</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fc4</span><span class="o">.</span><span class="n">covers</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        
        <span class="n">fc5</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="s">&quot;FC5&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">fc5</span><span class="o">.</span><span class="n">min_freq</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">fc5</span><span class="o">.</span><span class="n">max_freq</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fc5</span><span class="o">.</span><span class="n">covers</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TestOverlappingIFCTransformation.test_ifc_transforms"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestOverlappingIFCTransformation.test_ifc_transforms">[docs]</a>    <span class="k">def</span> <span class="nf">test_ifc_transforms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Test successful application of IFC transformations.&quot;&quot;&quot;</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">TestData</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="s">&quot;overlapping_iuc_transform.orm&quot;</span><span class="p">)</span>
        <span class="n">loader</span> <span class="o">=</span> <span class="n">NormaLoader</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">model</span> 

        <span class="n">obj</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">object_types</span><span class="o">.</span><span class="n">get</span>
        <span class="n">cons</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span>
        <span class="n">fact</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">get</span>

        <span class="c"># Check AHasBC</span>
        <span class="n">role1</span><span class="p">,</span> <span class="n">role2</span><span class="p">,</span> <span class="n">role3</span> <span class="o">=</span> <span class="n">fact</span><span class="p">(</span><span class="s">&quot;AHasBC&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;IUC_AB&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">covers</span><span class="p">,</span> <span class="p">[</span><span class="n">role1</span><span class="p">,</span> <span class="n">role2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;IUC_B&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">covers</span><span class="p">,</span> <span class="p">[</span><span class="n">role2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;IUC_BC&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">covers</span><span class="p">,</span> <span class="p">[</span><span class="n">role2</span><span class="p">,</span> <span class="n">role3</span><span class="p">])</span>

        <span class="c"># Check DHasEF</span>
        <span class="n">role1</span><span class="p">,</span> <span class="n">role2</span><span class="p">,</span> <span class="n">role3</span> <span class="o">=</span> <span class="n">fact</span><span class="p">(</span><span class="s">&quot;DHasEF&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;IUC_DE&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">covers</span><span class="p">,</span> <span class="p">[</span><span class="n">role1</span><span class="p">,</span> <span class="n">role2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;IUC_EF&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">covers</span><span class="p">,</span> <span class="p">[</span><span class="n">role2</span><span class="p">,</span> <span class="n">role3</span><span class="p">])</span>

        <span class="c"># Check GHasH</span>
        <span class="n">role1</span><span class="p">,</span> <span class="n">role2</span> <span class="o">=</span> <span class="n">fact</span><span class="p">(</span><span class="s">&quot;GHasH&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;IUC_G&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">covers</span><span class="p">,</span> <span class="p">[</span><span class="n">role1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;IUC_GH&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">covers</span><span class="p">,</span> <span class="p">[</span><span class="n">role1</span><span class="p">,</span> <span class="n">role2</span><span class="p">])</span>

        <span class="c"># Check IHasIJJ</span>
        <span class="n">role1</span><span class="p">,</span> <span class="n">role2</span><span class="p">,</span> <span class="n">role3</span><span class="p">,</span> <span class="n">role4</span> <span class="o">=</span> <span class="n">fact</span><span class="p">(</span><span class="s">&quot;IHasIJJ&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;IUC_II&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">covers</span><span class="p">,</span> <span class="p">[</span><span class="n">role1</span><span class="p">,</span> <span class="n">role2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;IUC_IJ&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">covers</span><span class="p">,</span> <span class="p">[</span><span class="n">role2</span><span class="p">,</span> <span class="n">role3</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;IUC_JJ&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">covers</span><span class="p">,</span> <span class="p">[</span><span class="n">role3</span><span class="p">,</span> <span class="n">role4</span><span class="p">])</span>

        <span class="c"># Check KHasLM</span>
        <span class="n">role1</span><span class="p">,</span> <span class="n">role2</span><span class="p">,</span> <span class="n">role3</span> <span class="o">=</span> <span class="n">fact</span><span class="p">(</span><span class="s">&quot;KHasLM&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;IUC_KLM&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">covers</span><span class="p">,</span> <span class="p">[</span><span class="n">role1</span><span class="p">,</span> <span class="n">role2</span><span class="p">,</span> <span class="n">role3</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;IUC_KL&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">covers</span><span class="p">,</span> <span class="p">[</span><span class="n">role1</span><span class="p">,</span> <span class="n">role2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;IUC_LM&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">covers</span><span class="p">,</span> <span class="p">[</span><span class="n">role2</span><span class="p">,</span> <span class="n">role3</span><span class="p">])</span>

        <span class="c"># Check NHasO</span>
        <span class="n">role1</span><span class="p">,</span> <span class="n">role2</span> <span class="o">=</span> <span class="n">fact</span><span class="p">(</span><span class="s">&quot;NHasO&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;FC_NO&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">covers</span><span class="p">,</span> <span class="p">[</span><span class="n">role1</span><span class="p">,</span> <span class="n">role2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;FC_NO&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">min_freq</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;FC_NO&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">max_freq</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;FC_O&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">covers</span><span class="p">,</span> <span class="p">[</span><span class="n">role2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;FC_O&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">min_freq</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;FC_O&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">max_freq</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

        <span class="c"># Check PHasQ</span>
        <span class="n">role1</span><span class="p">,</span> <span class="n">role2</span> <span class="o">=</span> <span class="n">fact</span><span class="p">(</span><span class="s">&quot;PHasQ&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;FC_PQ&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">covers</span><span class="p">,</span> <span class="p">[</span><span class="n">role1</span><span class="p">,</span> <span class="n">role2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;FC_PQ&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">min_freq</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;FC_PQ&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">max_freq</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;FC_Q&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">covers</span><span class="p">,</span> <span class="p">[</span><span class="n">role2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;FC_Q&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">min_freq</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;FC_Q&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">max_freq</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c"># Check RHasST</span>
        <span class="n">role1</span><span class="p">,</span> <span class="n">role2</span><span class="p">,</span> <span class="n">role3</span> <span class="o">=</span> <span class="n">fact</span><span class="p">(</span><span class="s">&quot;RHasST&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;IUC_RS&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">covers</span><span class="p">,</span> <span class="p">[</span><span class="n">role1</span><span class="p">,</span> <span class="n">role2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;FC_ST&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">covers</span><span class="p">,</span> <span class="p">[</span><span class="n">role2</span><span class="p">,</span> <span class="n">role3</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;FC_ST&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">min_freq</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;FC_ST&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">max_freq</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c"># Check UHasVW</span>
        <span class="n">role1</span><span class="p">,</span> <span class="n">role2</span><span class="p">,</span> <span class="n">role3</span> <span class="o">=</span> <span class="n">fact</span><span class="p">(</span><span class="s">&quot;UHasVW&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;IUC_UV&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">covers</span><span class="p">,</span> <span class="p">[</span><span class="n">role1</span><span class="p">,</span> <span class="n">role2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;FC_VW&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">covers</span><span class="p">,</span> <span class="p">[</span><span class="n">role2</span><span class="p">,</span> <span class="n">role3</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;FC_VW&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">min_freq</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;FC_VW&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">max_freq</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s">&#39;inf&#39;</span><span class="p">))</span>

        <span class="c"># Assert that transformation does something</span>
        <span class="n">trans</span> <span class="o">=</span> <span class="n">OverlappingIFCTransformation</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">execute</span><span class="p">())</span>
        <span class="c">#####################################################################</span>

        <span class="c"># Check AHasBC after transformation</span>
        <span class="n">role1</span><span class="p">,</span> <span class="n">role2</span><span class="p">,</span> <span class="n">role3</span> <span class="o">=</span> <span class="n">fact</span><span class="p">(</span><span class="s">&quot;AHasBC&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;IUC_AB&quot;</span><span class="p">))</span> <span class="c"># REMOVED</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;IUC_B&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">covers</span><span class="p">,</span> <span class="p">[</span><span class="n">role2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;IUC_BC&quot;</span><span class="p">))</span> <span class="c"># REMOVED</span>

        <span class="c"># Check DHasEF after transformation</span>
        <span class="n">role1</span><span class="p">,</span> <span class="n">role2</span><span class="p">,</span> <span class="n">role3</span> <span class="o">=</span> <span class="n">fact</span><span class="p">(</span><span class="s">&quot;DHasEF&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;IUC_DE&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">covers</span><span class="p">,</span> <span class="p">[</span><span class="n">role1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;IUC_EF&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">covers</span><span class="p">,</span> <span class="p">[</span><span class="n">role2</span><span class="p">,</span> <span class="n">role3</span><span class="p">])</span>

        <span class="c"># Check GHasH after transformation</span>
        <span class="n">role1</span><span class="p">,</span> <span class="n">role2</span> <span class="o">=</span> <span class="n">fact</span><span class="p">(</span><span class="s">&quot;GHasH&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;IUC_G&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">covers</span><span class="p">,</span> <span class="p">[</span><span class="n">role1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;IUC_GH&quot;</span><span class="p">))</span>

        <span class="c"># Check IHasIJJ after transformation</span>
        <span class="n">role1</span><span class="p">,</span> <span class="n">role2</span><span class="p">,</span> <span class="n">role3</span><span class="p">,</span> <span class="n">role4</span> <span class="o">=</span> <span class="n">fact</span><span class="p">(</span><span class="s">&quot;IHasIJJ&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;IUC_II&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">covers</span><span class="p">,</span> <span class="p">[</span><span class="n">role1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;IUC_IJ&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">covers</span><span class="p">,</span> <span class="p">[</span><span class="n">role2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;IUC_JJ&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">covers</span><span class="p">,</span> <span class="p">[</span><span class="n">role3</span><span class="p">,</span> <span class="n">role4</span><span class="p">])</span>

        <span class="c"># Check KHasLM after transformation</span>
        <span class="n">role1</span><span class="p">,</span> <span class="n">role2</span><span class="p">,</span> <span class="n">role3</span> <span class="o">=</span> <span class="n">fact</span><span class="p">(</span><span class="s">&quot;KHasLM&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;IUC_KLM&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;IUC_KL&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">covers</span><span class="p">,</span> <span class="p">[</span><span class="n">role1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;IUC_LM&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">covers</span><span class="p">,</span> <span class="p">[</span><span class="n">role2</span><span class="p">,</span> <span class="n">role3</span><span class="p">])</span>

        <span class="c"># Check NHasO after transformation</span>
        <span class="n">role1</span><span class="p">,</span> <span class="n">role2</span> <span class="o">=</span> <span class="n">fact</span><span class="p">(</span><span class="s">&quot;NHasO&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;FC_NO&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">covers</span><span class="p">,</span> <span class="p">[</span><span class="n">role1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;FC_NO&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">min_freq</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;FC_NO&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">max_freq</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;FC_O&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">covers</span><span class="p">,</span> <span class="p">[</span><span class="n">role2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;FC_O&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">min_freq</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;FC_O&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">max_freq</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

        <span class="c"># Check PHasQ after transformation</span>
        <span class="n">role1</span><span class="p">,</span> <span class="n">role2</span> <span class="o">=</span> <span class="n">fact</span><span class="p">(</span><span class="s">&quot;PHasQ&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;FC_PQ&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;FC_Q&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">covers</span><span class="p">,</span> <span class="p">[</span><span class="n">role2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;FC_Q&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">min_freq</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;FC_Q&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">max_freq</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c"># Check RHasST after transformation</span>
        <span class="n">role1</span><span class="p">,</span> <span class="n">role2</span><span class="p">,</span> <span class="n">role3</span> <span class="o">=</span> <span class="n">fact</span><span class="p">(</span><span class="s">&quot;RHasST&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;IUC_RS&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">covers</span><span class="p">,</span> <span class="p">[</span><span class="n">role1</span><span class="p">,</span> <span class="n">role2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;FC_ST&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">covers</span><span class="p">,</span> <span class="p">[</span><span class="n">role3</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;FC_ST&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">min_freq</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;FC_ST&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">max_freq</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c"># Check UHasVW after transformation</span>
        <span class="n">role1</span><span class="p">,</span> <span class="n">role2</span><span class="p">,</span> <span class="n">role3</span> <span class="o">=</span> <span class="n">fact</span><span class="p">(</span><span class="s">&quot;UHasVW&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;IUC_UV&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">covers</span><span class="p">,</span> <span class="p">[</span><span class="n">role1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;FC_VW&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">covers</span><span class="p">,</span> <span class="p">[</span><span class="n">role2</span><span class="p">,</span> <span class="n">role3</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;FC_VW&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">min_freq</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">cons</span><span class="p">(</span><span class="s">&quot;FC_VW&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">max_freq</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s">&#39;inf&#39;</span><span class="p">))</span>

        <span class="c"># Check added, modified, removed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">added</span><span class="p">,</span> <span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">([</span><span class="s">&quot;IUC_AB&quot;</span><span class="p">,</span> <span class="s">&quot;IUC_BC&quot;</span><span class="p">,</span> <span class="s">&quot;IUC_GH&quot;</span><span class="p">,</span> <span class="s">&quot;IUC_KLM&quot;</span><span class="p">,</span> <span class="s">&quot;FC_PQ&quot;</span><span class="p">],</span> 
                              <span class="p">[</span><span class="n">cons</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">cons</span> <span class="ow">in</span> <span class="n">trans</span><span class="o">.</span><span class="n">removed</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">([</span><span class="s">&quot;IUC_DE&quot;</span><span class="p">,</span> <span class="s">&quot;IUC_II&quot;</span><span class="p">,</span> <span class="s">&quot;IUC_IJ&quot;</span><span class="p">,</span> <span class="s">&quot;IUC_KL&quot;</span><span class="p">,</span> <span class="s">&quot;FC_NO&quot;</span><span class="p">,</span> <span class="s">&quot;FC_Q&quot;</span><span class="p">,</span> <span class="s">&quot;FC_ST&quot;</span><span class="p">,</span> <span class="s">&quot;IUC_UV&quot;</span><span class="p">],</span> 
                              <span class="p">[</span><span class="n">cons</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">cons</span> <span class="ow">in</span> <span class="n">trans</span><span class="o">.</span><span class="n">modified</span><span class="p">])</span>
        </div>
<div class="viewcode-block" id="TestOverlappingIFCTransformation.test_preservation_of_ref_roles"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestOverlappingIFCTransformation.test_preservation_of_ref_roles">[docs]</a>    <span class="k">def</span> <span class="nf">test_preservation_of_ref_roles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Test that removing an identifying constraint does not change the </span>
<span class="sd">            list of ref roles for an object type. &quot;&quot;&quot;</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">TestData</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="s">&quot;fact_type_tests.orm&quot;</span><span class="p">)</span>
        <span class="n">loader</span> <span class="o">=</span> <span class="n">NormaLoader</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">model</span>        

        <span class="n">a</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">object_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">)</span>
        <span class="n">role0</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;AHasB&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">role1</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;AExists&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">role2</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;AHasAId&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">roles</span><span class="p">,</span> <span class="p">[</span><span class="n">role0</span><span class="p">,</span> <span class="n">role1</span><span class="p">,</span> <span class="n">role2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">ref_roles</span><span class="p">,</span> <span class="p">[</span><span class="n">role2</span><span class="p">])</span>

        <span class="n">ident</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;Ident_A&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">identifying_constraint</span><span class="p">,</span> <span class="n">ident</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">ident</span><span class="o">.</span><span class="n">identifier_for</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>

        <span class="c"># Add a constraint which will sort before Ident_A by name</span>
        <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">UniquenessConstraint</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;__A&quot;</span><span class="p">,</span> <span class="n">covers</span><span class="o">=</span><span class="n">ident</span><span class="o">.</span><span class="n">covers</span><span class="p">))</span>

        <span class="n">trans</span> <span class="o">=</span> <span class="n">OverlappingIFCTransformation</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">execute</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">removed</span><span class="p">,</span> <span class="p">[</span><span class="n">ident</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;Ident_A&quot;</span><span class="p">))</span>

        <span class="c"># A no longer has an identifying constraint</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">identifying_constraint</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

        <span class="c"># However, its reference role hasn&#39;t changed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">ref_roles</span><span class="p">,</span> <span class="p">[</span><span class="n">role2</span><span class="p">])</span>

<span class="c">##############################################################################</span>
<span class="c"># EUCStrengtheningTransformation tests</span>
<span class="c">##############################################################################</span></div></div>
<div class="viewcode-block" id="TestEUCStrengtheningTransformation"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestEUCStrengtheningTransformation">[docs]</a><span class="k">class</span> <span class="nc">TestEUCStrengtheningTransformation</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Unit tests for the EUCStrengtheningTransformation class. &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestEUCStrengtheningTransformation.setUp"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestEUCStrengtheningTransformation.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxDiff</span> <span class="o">=</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="TestEUCStrengtheningTransformation.test_simple_linear_path"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestEUCStrengtheningTransformation.test_simple_linear_path">[docs]</a>    <span class="k">def</span> <span class="nf">test_simple_linear_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Test EUC strengthening on simple linear path. &quot;&quot;&quot;</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">TestData</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="s">&quot;join_rule_valid_linear_path_euc.orm&quot;</span><span class="p">)</span>
        <span class="n">loader</span> <span class="o">=</span> <span class="n">NormaLoader</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">model</span> 

        <span class="n">euc</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;EUC&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">euc</span><span class="o">.</span><span class="n">covers</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c"># Assert that transformation does something</span>
        <span class="n">trans</span> <span class="o">=</span> <span class="n">EUCStrengtheningTransformation</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">execute</span><span class="p">())</span>

        <span class="c"># Confirm EUC no longer in model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;EUC&quot;</span><span class="p">))</span>

        <span class="c"># Get new uniqueness constraints</span>
        <span class="n">root_cons</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;AHasB&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">covered_by</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">root_cons</span><span class="p">,</span> <span class="n">UniquenessConstraint</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">root_cons</span><span class="o">.</span><span class="n">covers</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">new_cons1</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;BHasC&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">covered_by</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">new_cons1</span><span class="p">,</span> <span class="n">UniquenessConstraint</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">new_cons1</span><span class="o">.</span><span class="n">covers</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c"># First role of CHasD already covered by a simple IUC, so there should</span>
        <span class="c"># not be a new one added</span>
        <span class="n">role</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;CHasD&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">cons</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;IUC_C&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">role</span><span class="o">.</span><span class="n">covered_by</span><span class="p">,</span> <span class="p">[</span><span class="n">cons</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cons</span><span class="o">.</span><span class="n">covers</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c"># Check added, modified, removed lists</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">added</span><span class="p">,</span> <span class="p">[</span><span class="n">root_cons</span><span class="p">,</span> <span class="n">new_cons1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">removed</span><span class="p">,</span> <span class="p">[</span><span class="n">euc</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">modified</span><span class="p">,</span> <span class="p">[])</span>
</div>
<div class="viewcode-block" id="TestEUCStrengtheningTransformation.test_compound_ref_scheme"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestEUCStrengtheningTransformation.test_compound_ref_scheme">[docs]</a>    <span class="k">def</span> <span class="nf">test_compound_ref_scheme</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Test using EUC strengthening for compound ref scheme. &quot;&quot;&quot;</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">TestData</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="s">&quot;absorption_valid_four_facts.orm&quot;</span><span class="p">)</span>
        <span class="n">loader</span> <span class="o">=</span> <span class="n">NormaLoader</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">model</span>

        <span class="n">euc</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;EUC1&quot;</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">object_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">euc</span><span class="o">.</span><span class="n">covers</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">euc</span><span class="o">.</span><span class="n">identifier_for</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">identifying_constraint</span><span class="p">,</span> <span class="n">euc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">ref_roles</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">roles</span><span class="p">)</span>

        <span class="n">trans</span> <span class="o">=</span> <span class="n">EUCStrengtheningTransformation</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">execute</span><span class="p">())</span>

        <span class="c"># Confirm EUC removed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;EUC1&quot;</span><span class="p">))</span>

        <span class="c"># Assert a has no identifying constraint but ref roles haven&#39;t changed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">identifying_constraint</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">ref_roles</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">roles</span><span class="p">)</span>

        <span class="c"># Confirm constraints the same on ref roles</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">covered_by</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">covered_by</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">covered_by</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">covered_by</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c"># Confirm role played by B now covered by IUC</span>
        <span class="n">role</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fact_type</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">new_cons</span> <span class="o">=</span> <span class="n">role</span><span class="o">.</span><span class="n">covered_by</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">role</span><span class="o">.</span><span class="n">covered_by</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">new_cons</span><span class="p">,</span> <span class="n">UniquenessConstraint</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">role</span><span class="o">.</span><span class="n">unique</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">10</span><span class="p">)</span>

        <span class="c"># Check added, removed, modified lists</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">modified</span><span class="p">,</span> <span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">removed</span><span class="p">,</span> <span class="p">[</span><span class="n">euc</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">added</span><span class="p">,</span> <span class="p">[</span><span class="n">new_cons</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="TestEUCStrengtheningTransformation.test_skipped_due_to_no_join_path"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestEUCStrengtheningTransformation.test_skipped_due_to_no_join_path">[docs]</a>    <span class="k">def</span> <span class="nf">test_skipped_due_to_no_join_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Test that EUC is skipped because it has no join path. &quot;&quot;&quot;</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="o">.</span><span class="n">Model</span><span class="p">()</span>
        <span class="n">fact1</span> <span class="o">=</span> <span class="n">FactType</span><span class="p">(</span><span class="s">&quot;AHasB&quot;</span><span class="p">)</span>
        <span class="n">fact1</span><span class="o">.</span><span class="n">add_role</span><span class="p">(</span><span class="n">ObjectType</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">))</span>
        <span class="n">fact1</span><span class="o">.</span><span class="n">add_role</span><span class="p">(</span><span class="n">ObjectType</span><span class="p">(</span><span class="s">&quot;B&quot;</span><span class="p">))</span>
        <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">fact1</span><span class="p">)</span>

        <span class="n">fact2</span> <span class="o">=</span> <span class="n">FactType</span><span class="p">(</span><span class="s">&quot;AHasC&quot;</span><span class="p">)</span>
        <span class="n">fact2</span><span class="o">.</span><span class="n">add_role</span><span class="p">(</span><span class="n">ObjectType</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">))</span>
        <span class="n">fact2</span><span class="o">.</span><span class="n">add_role</span><span class="p">(</span><span class="n">ObjectType</span><span class="p">(</span><span class="s">&quot;C&quot;</span><span class="p">))</span>
        <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">fact2</span><span class="p">)</span>

        <span class="n">covers</span> <span class="o">=</span> <span class="n">RoleSequence</span><span class="p">()</span>
        <span class="n">covers</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">fact1</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">fact2</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        
        <span class="n">euc</span> <span class="o">=</span> <span class="n">UniquenessConstraint</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;EUC&quot;</span><span class="p">,</span> <span class="n">covers</span><span class="o">=</span><span class="n">covers</span><span class="p">)</span>
        <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">euc</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">euc</span><span class="o">.</span><span class="n">internal</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">euc</span><span class="o">.</span><span class="n">covers</span><span class="o">.</span><span class="n">join_path</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">EUCStrengtheningTransformation</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">euc</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;EUC&quot;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestEUCStrengtheningTransformation.test_skipped_due_to_join_path_out_of_order"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestEUCStrengtheningTransformation.test_skipped_due_to_join_path_out_of_order">[docs]</a>    <span class="k">def</span> <span class="nf">test_skipped_due_to_join_path_out_of_order</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; EUC skipped because it doesn&#39;t cover a role on the first fact type</span>
<span class="sd">            along the join path. &quot;&quot;&quot;</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">TestData</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="s">&quot;join_rule_join_path_defined_out_of_order.orm&quot;</span><span class="p">)</span>
        <span class="n">loader</span> <span class="o">=</span> <span class="n">NormaLoader</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">model</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;EUC&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">EUCStrengtheningTransformation</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;EUC&quot;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TestEUCStrengtheningTransformation.test_euc_on_branching_path"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestEUCStrengtheningTransformation.test_euc_on_branching_path">[docs]</a>    <span class="k">def</span> <span class="nf">test_euc_on_branching_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Test strengthening of complex branching path. &quot;&quot;&quot;</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">TestData</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="s">&quot;join_rule_valid_complex_branching_path.orm&quot;</span><span class="p">)</span>
        <span class="n">loader</span> <span class="o">=</span> <span class="n">NormaLoader</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">model</span>

        <span class="n">euc</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;EUC1&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">euc</span><span class="o">.</span><span class="n">covers</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span>

        <span class="n">trans</span> <span class="o">=</span> <span class="n">EUCStrengtheningTransformation</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">execute</span><span class="p">())</span>

        <span class="c"># Confirm EUC removed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;EUC1&quot;</span><span class="p">))</span>

        <span class="c"># Confirm a new IUC is on role played by D</span>
        <span class="n">new_iuc</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">object_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;D&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">covered_by</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="c"># Confirm all expected constraints added</span>
        <span class="n">ehasb</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;EHasB&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">covered_by</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">bhasc</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;BHasC&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">covered_by</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ghasb</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;GHasB&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">covered_by</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">fhasg</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;FHasG&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">covered_by</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">hhasg</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;HHasG&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">covered_by</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">new_cons</span> <span class="o">=</span> <span class="p">[</span><span class="n">new_iuc</span><span class="p">,</span> <span class="n">ehasb</span><span class="p">,</span> <span class="n">bhasc</span><span class="p">,</span> <span class="n">ghasb</span><span class="p">,</span> <span class="n">fhasg</span><span class="p">,</span> <span class="n">hhasg</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">cons</span> <span class="ow">in</span> <span class="n">new_cons</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">cons</span><span class="p">,</span> <span class="n">UniquenessConstraint</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">cons</span><span class="o">.</span><span class="n">simple</span><span class="p">)</span>

        <span class="c"># Check lists of added, modified, and removed constraints</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">added</span><span class="p">,</span> <span class="n">new_cons</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">removed</span><span class="p">,</span> <span class="p">[</span><span class="n">euc</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">modified</span><span class="p">,</span> <span class="p">[])</span>   

<span class="c">##############################################################################</span>
<span class="c"># Unsupported Subset Removal tests</span>
<span class="c">##############################################################################</span></div></div>
<div class="viewcode-block" id="TestUnsupportedSubsetRemoval"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestUnsupportedSubsetRemoval">[docs]</a><span class="k">class</span> <span class="nc">TestUnsupportedSubsetRemoval</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Unit tests for the UnsupportedSubsetRemoval class. &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestUnsupportedSubsetRemoval.setUp"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestUnsupportedSubsetRemoval.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxDiff</span> <span class="o">=</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="TestUnsupportedSubsetRemoval.test_removed_constraints"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestUnsupportedSubsetRemoval.test_removed_constraints">[docs]</a>    <span class="k">def</span> <span class="nf">test_removed_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Test that unsupported constraints are removed. &quot;&quot;&quot;</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">TestData</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="s">&quot;subset_variety.orm&quot;</span><span class="p">)</span>
        <span class="n">loader</span> <span class="o">=</span> <span class="n">NormaLoader</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">model</span>

        <span class="n">sub_ok</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;SUB_OK&quot;</span><span class="p">)</span>
        <span class="n">sub_ok2</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;SUB_OK2&quot;</span><span class="p">)</span>
        <span class="n">sub_ok3</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;SUB_OK3&quot;</span><span class="p">)</span>

        <span class="n">sub_join</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;SUB_JOIN&quot;</span><span class="p">)</span>
        <span class="n">sub_join2</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;SUB_JOIN2&quot;</span><span class="p">)</span>

        <span class="n">sub_incompat</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;SUB_INCOMPAT&quot;</span><span class="p">)</span>

        <span class="n">sub_superset_ref</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;SUB_SUPERSET_REF&quot;</span><span class="p">)</span>
        <span class="n">sub_superset_subtype</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;SUB_SUPERSET_SUBTYPE&quot;</span><span class="p">)</span>

        <span class="n">sub_cycle</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;SUB_CYCLE&quot;</span><span class="p">)</span>

        <span class="c"># Assert these are all subset constraints</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">sub_ok</span><span class="p">,</span> <span class="n">SubsetConstraint</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">sub_ok2</span><span class="p">,</span> <span class="n">SubsetConstraint</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">sub_ok3</span><span class="p">,</span> <span class="n">SubsetConstraint</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">sub_join</span><span class="p">,</span> <span class="n">SubsetConstraint</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">sub_join2</span><span class="p">,</span> <span class="n">SubsetConstraint</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">sub_incompat</span><span class="p">,</span> <span class="n">SubsetConstraint</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">sub_superset_ref</span><span class="p">,</span> <span class="n">SubsetConstraint</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">sub_superset_subtype</span><span class="p">,</span> <span class="n">SubsetConstraint</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">sub_cycle</span><span class="p">,</span> <span class="n">SubsetConstraint</span><span class="p">))</span>

        <span class="c"># Execute transformation</span>
        <span class="n">trans</span> <span class="o">=</span> <span class="n">UnsupportedSubsetRemoval</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">execute</span><span class="p">())</span>
    
        <span class="c"># OK constraints still in model        </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;SUB_OK&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;SUB_OK2&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;SUB_OK3&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;SUB_SUPERSET_REF&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;SUB_SUPERSET_SUBTYPE&quot;</span><span class="p">))</span>

        <span class="c"># Mandatories added</span>
        <span class="n">mc1</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;subset_mc&quot;</span><span class="p">)</span>
        <span class="n">mc2</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;subset_mc2&quot;</span><span class="p">)</span>

        <span class="n">role1</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;CHasD&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">role2</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;FLikesFId&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">role1</span><span class="o">.</span><span class="n">mandatory</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">role2</span><span class="o">.</span><span class="n">mandatory</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">mc1</span><span class="o">.</span><span class="n">covers</span><span class="p">,</span> <span class="p">[</span><span class="n">role1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">mc2</span><span class="o">.</span><span class="n">covers</span><span class="p">,</span> <span class="p">[</span><span class="n">role2</span><span class="p">])</span>

        <span class="c"># Unsupported constraints removed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;SUB_JOIN&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;SUB_JOIN2&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;SUB_INCOMPAT&quot;</span><span class="p">))</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;SUB_CYCLE&quot;</span><span class="p">))</span>

        <span class="c"># Check lists of added, modified, and removed constraints</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">added</span><span class="p">,</span> <span class="p">[</span><span class="n">mc1</span><span class="p">,</span> <span class="n">mc2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">removed</span><span class="p">,</span> 
                              <span class="p">[</span><span class="n">sub_join</span><span class="p">,</span> <span class="n">sub_join2</span><span class="p">,</span> <span class="n">sub_incompat</span><span class="p">,</span> <span class="n">sub_cycle</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">modified</span><span class="p">,</span> <span class="p">[])</span> 
</div>
<div class="viewcode-block" id="TestUnsupportedSubsetRemoval.test_direct_subsets_function"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestUnsupportedSubsetRemoval.test_direct_subsets_function">[docs]</a>    <span class="k">def</span> <span class="nf">test_direct_subsets_function</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Test direct_subsets function that returns subset roles adjacent to a role. &quot;&quot;&quot;</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">TestData</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="s">&quot;subset_variety.orm&quot;</span><span class="p">)</span>
        <span class="n">loader</span> <span class="o">=</span> <span class="n">NormaLoader</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">model</span>

        <span class="n">role</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;ALikesC&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">role2</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;BHasC&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="c">#trans = UnsupportedSubsetRemoval(model)</span>

        <span class="n">actual</span> <span class="o">=</span> <span class="p">[(</span><span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">)</span> <span class="ow">in</span> <span class="n">direct_subsets</span><span class="p">(</span><span class="n">role</span><span class="p">)]</span>

        <span class="n">expected</span> <span class="o">=</span> <span class="p">[(</span><span class="n">role2</span><span class="p">,</span> <span class="s">&quot;SUB_OK3&quot;</span><span class="p">),</span> <span class="p">(</span><span class="n">role2</span><span class="p">,</span> <span class="s">&quot;SUB_JOIN&quot;</span><span class="p">)]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">actual</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span> 
</div>
<div class="viewcode-block" id="TestUnsupportedSubsetRemoval.test_cycle_detection_1"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestUnsupportedSubsetRemoval.test_cycle_detection_1">[docs]</a>    <span class="k">def</span> <span class="nf">test_cycle_detection_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Test cycle detection #1. &quot;&quot;&quot;</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">TestData</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="s">&quot;subset_variety.orm&quot;</span><span class="p">)</span>
        <span class="n">loader</span> <span class="o">=</span> <span class="n">NormaLoader</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">model</span>

        <span class="n">sub_cycle</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;SUB_CYCLE&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">sub_cycle</span><span class="p">)</span>

        <span class="n">trans</span> <span class="o">=</span> <span class="n">UnsupportedSubsetRemoval</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="n">trans</span><span class="o">.</span><span class="n">_remove_subset_cycles</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;SUB_CYCLE&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">removed</span><span class="p">,</span> <span class="p">[</span><span class="n">sub_cycle</span><span class="p">])</span>   
</div>
<div class="viewcode-block" id="TestUnsupportedSubsetRemoval.test_cycle_detection_no_cycle"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestUnsupportedSubsetRemoval.test_cycle_detection_no_cycle">[docs]</a>    <span class="k">def</span> <span class="nf">test_cycle_detection_no_cycle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Model has undirected cycle but not a directed cycle. &quot;&quot;&quot;</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">TestData</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="s">&quot;subset_no_cycle.orm&quot;</span><span class="p">)</span>
        <span class="n">loader</span> <span class="o">=</span> <span class="n">NormaLoader</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">model</span> 

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="n">SubsetConstraint</span><span class="p">)))</span>

        <span class="n">trans</span> <span class="o">=</span> <span class="n">UnsupportedSubsetRemoval</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">execute</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="n">SubsetConstraint</span><span class="p">)))</span>
</div>
<div class="viewcode-block" id="TestUnsupportedSubsetRemoval.test_simple_cycle_detection"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestUnsupportedSubsetRemoval.test_simple_cycle_detection">[docs]</a>    <span class="k">def</span> <span class="nf">test_simple_cycle_detection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Model has a simple directed cycle. &quot;&quot;&quot;</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">TestData</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="s">&quot;subset_simple_cycle.orm&quot;</span><span class="p">)</span>
        <span class="n">loader</span> <span class="o">=</span> <span class="n">NormaLoader</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">model</span> 

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="n">SubsetConstraint</span><span class="p">)))</span>

        <span class="n">trans</span> <span class="o">=</span> <span class="n">UnsupportedSubsetRemoval</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">execute</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="n">SubsetConstraint</span><span class="p">)))</span>

        <span class="c"># Transformation does nothing now that cycles are removed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">UnsupportedSubsetRemoval</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="TestUnsupportedSubsetRemoval.test_simple_cycle_detection_2"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestUnsupportedSubsetRemoval.test_simple_cycle_detection_2">[docs]</a>    <span class="k">def</span> <span class="nf">test_simple_cycle_detection_2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Model has a simple directed cycle requiring deletion of 2 constraints. &quot;&quot;&quot;</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">TestData</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="s">&quot;subset_simple_cycle_2.orm&quot;</span><span class="p">)</span>
        <span class="n">loader</span> <span class="o">=</span> <span class="n">NormaLoader</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">model</span> 

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="n">SubsetConstraint</span><span class="p">)))</span>

        <span class="n">trans</span> <span class="o">=</span> <span class="n">UnsupportedSubsetRemoval</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">execute</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="n">SubsetConstraint</span><span class="p">)))</span>

        <span class="c"># Transformation does nothing now that cycles are removed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">UnsupportedSubsetRemoval</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="TestUnsupportedSubsetRemoval.test_simple_cycle_detection_3"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestUnsupportedSubsetRemoval.test_simple_cycle_detection_3">[docs]</a>    <span class="k">def</span> <span class="nf">test_simple_cycle_detection_3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Model has a simple directed cycle requiring deletion of 2 </span>
<span class="sd">            constraints on the same fact type. &quot;&quot;&quot;</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">TestData</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="s">&quot;subset_simple_cycle_3.orm&quot;</span><span class="p">)</span>
        <span class="n">loader</span> <span class="o">=</span> <span class="n">NormaLoader</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">model</span> 

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="n">SubsetConstraint</span><span class="p">)))</span>

        <span class="n">trans</span> <span class="o">=</span> <span class="n">UnsupportedSubsetRemoval</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">execute</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="n">SubsetConstraint</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c"># Transformation does nothing now that cycles are removed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">UnsupportedSubsetRemoval</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">())</span>

<span class="c">##############################################################################</span>
<span class="c"># Tuple Subset Transformation tests</span>
<span class="c">##############################################################################</span></div></div>
<div class="viewcode-block" id="TestTupleSubsetTransformation"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestTupleSubsetTransformation">[docs]</a><span class="k">class</span> <span class="nc">TestTupleSubsetTransformation</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Unit tests for the TupleSubsetTransformation class. &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestTupleSubsetTransformation.setUp"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestTupleSubsetTransformation.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxDiff</span> <span class="o">=</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="TestTupleSubsetTransformation.test_ternary_subset"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestTupleSubsetTransformation.test_ternary_subset">[docs]</a>    <span class="k">def</span> <span class="nf">test_ternary_subset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Test transformation of ternary subset. &quot;&quot;&quot;</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">TestData</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="s">&quot;subset_tuple.orm&quot;</span><span class="p">)</span>
        <span class="n">loader</span> <span class="o">=</span> <span class="n">NormaLoader</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">model</span> 

        <span class="n">subset</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;SUB1&quot;</span><span class="p">)</span>
        <span class="n">uniq</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;IUC1&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">uniq</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="n">SubsetConstraint</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="n">UniquenessConstraint</span><span class="p">)))</span>

        <span class="c"># Transform model</span>
        <span class="n">trans</span> <span class="o">=</span> <span class="n">TupleSubsetTransformation</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">execute</span><span class="p">())</span>

        <span class="c"># Confirm tuple subset is still present</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;SUB1&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;IUC1&quot;</span><span class="p">))</span>

        <span class="c"># Confirm new simple subsets added</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="n">SubsetConstraint</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="n">UniquenessConstraint</span><span class="p">)))</span>

        <span class="n">fact_type</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;AHasBCD&quot;</span><span class="p">)</span>

        <span class="c"># Check constraints on role played by A</span>
        <span class="n">sc0</span> <span class="o">=</span> <span class="n">fact_type</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">covered_by</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">sc1</span> <span class="o">=</span> <span class="n">fact_type</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">covered_by</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">uc1</span> <span class="o">=</span> <span class="n">fact_type</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">covered_by</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">sc0</span><span class="p">,</span> <span class="n">subset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">sc1</span><span class="p">,</span> <span class="n">SubsetConstraint</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sc1</span><span class="o">.</span><span class="n">subset</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">uc1</span><span class="p">,</span> <span class="n">UniquenessConstraint</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uc1</span><span class="o">.</span><span class="n">covers</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c"># Check constraints on role played by B</span>
        <span class="n">uc2</span> <span class="o">=</span> <span class="n">fact_type</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">covered_by</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">sc0</span> <span class="o">=</span> <span class="n">fact_type</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">covered_by</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">sc2</span> <span class="o">=</span> <span class="n">fact_type</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">covered_by</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">sc0</span><span class="p">,</span> <span class="n">subset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">uc2</span><span class="p">,</span> <span class="n">uniq</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">sc2</span><span class="p">,</span> <span class="n">SubsetConstraint</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sc2</span><span class="o">.</span><span class="n">subset</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c"># Check constraints on role played by C</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">fact_type</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">covered_by</span><span class="p">,</span> <span class="p">[])</span>

        <span class="c"># Check constraints on role played by D</span>
        <span class="n">sc0</span> <span class="o">=</span> <span class="n">fact_type</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">covered_by</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">sc3</span> <span class="o">=</span> <span class="n">fact_type</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">covered_by</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">uc3</span> <span class="o">=</span> <span class="n">fact_type</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">covered_by</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">sc0</span><span class="p">,</span> <span class="n">subset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">sc3</span><span class="p">,</span> <span class="n">SubsetConstraint</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sc3</span><span class="o">.</span><span class="n">subset</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">uc3</span><span class="p">,</span> <span class="n">UniquenessConstraint</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uc3</span><span class="o">.</span><span class="n">covers</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c"># Check contents of added, removed, modified</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">added</span><span class="p">,</span> <span class="p">[</span><span class="n">sc1</span><span class="p">,</span> <span class="n">sc2</span><span class="p">,</span> <span class="n">sc3</span><span class="p">,</span> <span class="n">uc1</span><span class="p">,</span> <span class="n">uc3</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">removed</span><span class="p">,</span> <span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">modified</span><span class="p">,</span> <span class="p">[])</span>
</div>
<div class="viewcode-block" id="TestTupleSubsetTransformation.test_ternary_equality"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestTupleSubsetTransformation.test_ternary_equality">[docs]</a>    <span class="k">def</span> <span class="nf">test_ternary_equality</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Test transformation of ternary equality. &quot;&quot;&quot;</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">TestData</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="s">&quot;equality_tuple.orm&quot;</span><span class="p">)</span>
        <span class="n">loader</span> <span class="o">=</span> <span class="n">NormaLoader</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">model</span> 

        <span class="n">equal</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;EQ&quot;</span><span class="p">)</span>
        <span class="n">uniq</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;IUC1&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">equal</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">uniq</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="n">EqualityConstraint</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="n">UniquenessConstraint</span><span class="p">)))</span>

        <span class="c"># Transform model</span>
        <span class="n">trans</span> <span class="o">=</span> <span class="n">TupleSubsetTransformation</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">execute</span><span class="p">())</span>

        <span class="c"># Confirm tuple equality is still present</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;EQ&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;IUC1&quot;</span><span class="p">))</span>

        <span class="c"># Confirm new simple subsets added</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="n">EqualityConstraint</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="n">UniquenessConstraint</span><span class="p">)))</span>

        <span class="n">fact_type</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;AHasBCD&quot;</span><span class="p">)</span>

        <span class="c"># Check constraints on role played by A</span>
        <span class="n">eq0</span> <span class="o">=</span> <span class="n">fact_type</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">covered_by</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">eq1</span> <span class="o">=</span> <span class="n">fact_type</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">covered_by</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">uc1</span> <span class="o">=</span> <span class="n">fact_type</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">covered_by</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">eq0</span><span class="p">,</span> <span class="n">equal</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">eq1</span><span class="p">,</span> <span class="n">EqualityConstraint</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">eq1</span><span class="o">.</span><span class="n">subset</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">uc1</span><span class="p">,</span> <span class="n">UniquenessConstraint</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uc1</span><span class="o">.</span><span class="n">covers</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c"># Check constraints on role played by B</span>
        <span class="n">uc2</span> <span class="o">=</span> <span class="n">fact_type</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">covered_by</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">eq0</span> <span class="o">=</span> <span class="n">fact_type</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">covered_by</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">eq2</span> <span class="o">=</span> <span class="n">fact_type</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">covered_by</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">eq0</span><span class="p">,</span> <span class="n">equal</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">uc2</span><span class="p">,</span> <span class="n">uniq</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">eq2</span><span class="p">,</span> <span class="n">EqualityConstraint</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">eq2</span><span class="o">.</span><span class="n">subset</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c"># Check constraints on role played by C</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">fact_type</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">covered_by</span><span class="p">,</span> <span class="p">[])</span>

        <span class="c"># Check constraints on role played by D</span>
        <span class="n">eq0</span> <span class="o">=</span> <span class="n">fact_type</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">covered_by</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">eq3</span> <span class="o">=</span> <span class="n">fact_type</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">covered_by</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">uc3</span> <span class="o">=</span> <span class="n">fact_type</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">covered_by</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">eq0</span><span class="p">,</span> <span class="n">equal</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">eq3</span><span class="p">,</span> <span class="n">EqualityConstraint</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">eq3</span><span class="o">.</span><span class="n">subset</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">uc3</span><span class="p">,</span> <span class="n">UniquenessConstraint</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uc3</span><span class="o">.</span><span class="n">covers</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c"># Confirm IUC add to role played by D in ternary fact type</span>
        <span class="c"># (i.e. the &quot;superset&quot; of the equality constraint)</span>
        <span class="n">role</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;AHasBD&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">uc4</span> <span class="o">=</span> <span class="n">role</span><span class="o">.</span><span class="n">covered_by</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">uc4</span><span class="p">,</span> <span class="n">UniquenessConstraint</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uc4</span><span class="o">.</span><span class="n">covers</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c"># Check contents of added, removed, modified</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">added</span><span class="p">,</span> <span class="p">[</span><span class="n">eq1</span><span class="p">,</span> <span class="n">eq2</span><span class="p">,</span> <span class="n">eq3</span><span class="p">,</span> <span class="n">uc1</span><span class="p">,</span> <span class="n">uc3</span><span class="p">,</span> <span class="n">uc4</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">removed</span><span class="p">,</span> <span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">modified</span><span class="p">,</span> <span class="p">[])</span>
</div>
<div class="viewcode-block" id="TestTupleSubsetTransformation.test_binary_equality"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestTupleSubsetTransformation.test_binary_equality">[docs]</a>    <span class="k">def</span> <span class="nf">test_binary_equality</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Test transformation of binary equality. &quot;&quot;&quot;</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">TestData</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="s">&quot;equality_tuple2.orm&quot;</span><span class="p">)</span>
        <span class="n">loader</span> <span class="o">=</span> <span class="n">NormaLoader</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">model</span>

        <span class="c"># Transform model</span>
        <span class="n">trans</span> <span class="o">=</span> <span class="n">TupleSubsetTransformation</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">execute</span><span class="p">())</span>
 
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="n">EqualityConstraint</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="n">UniquenessConstraint</span><span class="p">)))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;ALikesB&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">)</span>        

<span class="c">##############################################################################</span>
<span class="c"># Root Role Transformation tests</span>
<span class="c">##############################################################################</span></div></div>
<div class="viewcode-block" id="TestRootRoleTransformation"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestRootRoleTransformation">[docs]</a><span class="k">class</span> <span class="nc">TestRootRoleTransformation</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Unit tests for the RootRoleTransformation class. &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestRootRoleTransformation.setUp"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestRootRoleTransformation.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxDiff</span> <span class="o">=</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="TestRootRoleTransformation.test_subset_single_root"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestRootRoleTransformation.test_subset_single_root">[docs]</a>    <span class="k">def</span> <span class="nf">test_subset_single_root</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Subset graph has a single root. &quot;&quot;&quot;</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">TestData</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="s">&quot;subset_no_cycle.orm&quot;</span><span class="p">)</span>
        <span class="n">loader</span> <span class="o">=</span> <span class="n">NormaLoader</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">model</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="n">SubsetConstraint</span><span class="p">)))</span>

        <span class="c"># Execute transformation</span>
        <span class="n">trans</span> <span class="o">=</span> <span class="n">RootRoleTransformation</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">execute</span><span class="p">())</span>

        <span class="c"># Confirm no change in constraints</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="n">SubsetConstraint</span><span class="p">)))</span>

        <span class="n">expected_root</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;ASmokes&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c"># KEY: Confirm all roles played by A have expected root</span>
        <span class="n">roles</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">object_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span> <span class="k">if</span> <span class="n">r</span> <span class="o">!=</span> <span class="n">expected_root</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">roles</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">role</span> <span class="ow">in</span> <span class="n">roles</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">role</span><span class="o">.</span><span class="n">root_role</span><span class="p">,</span> <span class="n">expected_root</span><span class="p">)</span>

        <span class="c"># Confirm roles played by B have no root</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">object_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;B&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&quot;root_role&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s">&quot;root_role&quot;</span><span class="p">))</span>

        <span class="c"># Check contents of added, removed, modified</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">added</span><span class="p">,</span> <span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">removed</span><span class="p">,</span> <span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">modified</span><span class="p">,</span> <span class="p">[])</span>     
</div>
<div class="viewcode-block" id="TestRootRoleTransformation.test_subset_multiple_roots"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestRootRoleTransformation.test_subset_multiple_roots">[docs]</a>    <span class="k">def</span> <span class="nf">test_subset_multiple_roots</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Subset graph has multiple roots. &quot;&quot;&quot;</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">TestData</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="s">&quot;subset_multiple_roots.orm&quot;</span><span class="p">)</span>
        <span class="n">loader</span> <span class="o">=</span> <span class="n">NormaLoader</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">model</span>
  
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="n">SubsetConstraint</span><span class="p">)))</span>

        <span class="c"># Execute transformation</span>
        <span class="n">trans</span> <span class="o">=</span> <span class="n">RootRoleTransformation</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">execute</span><span class="p">())</span>

        <span class="c"># Confirm addition of two new subset constraints</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="n">SubsetConstraint</span><span class="p">)))</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">object_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">)</span>
        <span class="n">asmokes</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;ASmokes&quot;</span><span class="p">)</span>
        <span class="n">aexists</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;AExists&quot;</span><span class="p">)</span>
        <span class="n">alikesb</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;ALikesB&quot;</span><span class="p">)</span>

        <span class="n">sub1</span> <span class="o">=</span> <span class="n">asmokes</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">covered_by</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="c"># covered_by[0] is an IUC</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">sub1</span><span class="p">,</span> <span class="n">SubsetConstraint</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">sub1</span><span class="o">.</span><span class="n">subset</span><span class="p">,</span> <span class="p">[</span><span class="n">asmokes</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">sub1</span><span class="o">.</span><span class="n">superset</span><span class="p">,</span> <span class="p">[</span><span class="n">alikesb</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

        <span class="n">sub2</span> <span class="o">=</span> <span class="n">aexists</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">covered_by</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="c"># covered_by[0] is IUC, [1] is subset, [2] is cardinality</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">sub2</span><span class="p">,</span> <span class="n">SubsetConstraint</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">sub2</span><span class="o">.</span><span class="n">subset</span><span class="p">,</span> <span class="p">[</span><span class="n">aexists</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">sub2</span><span class="o">.</span><span class="n">superset</span><span class="p">,</span> <span class="p">[</span><span class="n">alikesb</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

        <span class="c"># Confirm all of A&#39;s roles roots are the A likes B role</span>
        <span class="n">expected_root</span> <span class="o">=</span> <span class="n">alikesb</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">roles</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">roles</span> <span class="k">if</span> <span class="n">r</span> <span class="o">!=</span> <span class="n">expected_root</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">roles</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">role</span> <span class="ow">in</span> <span class="n">roles</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">role</span><span class="o">.</span><span class="n">root_role</span><span class="p">,</span> <span class="n">expected_root</span><span class="p">)</span>        

        <span class="c"># Confirm A&#39;s A likes B role has no root</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">expected_root</span><span class="p">,</span> <span class="s">&quot;root_role&quot;</span><span class="p">))</span>

        <span class="c"># Confirm B&#39;s subset role has correct root_role        </span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">object_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;B&quot;</span><span class="p">)</span>
        <span class="n">b1</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;AHasB&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">b2</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;ALikesB&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span> <span class="s">&quot;root_role&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">b2</span><span class="p">,</span> <span class="s">&quot;root_role&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">b1</span><span class="o">.</span><span class="n">root_role</span><span class="p">,</span> <span class="n">b2</span><span class="p">)</span>

        <span class="c"># Confirm C&#39;s role has no root_role attribute</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">object_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;C&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&quot;root_role&quot;</span><span class="p">))</span>

        <span class="c"># Check contents of added, removed, modified</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">added</span><span class="p">,</span> <span class="p">[</span><span class="n">sub1</span><span class="p">,</span> <span class="n">sub2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">removed</span><span class="p">,</span> <span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">modified</span><span class="p">,</span> <span class="p">[])</span>
</div>
<div class="viewcode-block" id="TestRootRoleTransformation.test_root_on_subtype_and_supertype"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestRootRoleTransformation.test_root_on_subtype_and_supertype">[docs]</a>    <span class="k">def</span> <span class="nf">test_root_on_subtype_and_supertype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Subset graph has multiple roots, where one is a subtype and</span>
<span class="sd">            one is a supertype. &quot;&quot;&quot;</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">TestData</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="s">&quot;subset_root_role_test.orm&quot;</span><span class="p">)</span>
        <span class="n">loader</span> <span class="o">=</span> <span class="n">NormaLoader</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">model</span>
  
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="n">SubsetConstraint</span><span class="p">)))</span>

        <span class="c"># Execute transformation</span>
        <span class="n">trans</span> <span class="o">=</span> <span class="n">RootRoleTransformation</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">execute</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">of_type</span><span class="p">(</span><span class="n">SubsetConstraint</span><span class="p">)))</span>

        <span class="n">root1</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;AExists&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">root2</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;BExists&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">root1</span><span class="p">,</span> <span class="s">&quot;root_role&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">root2</span><span class="o">.</span><span class="n">root_role</span><span class="p">,</span> <span class="n">root1</span><span class="p">)</span>

<span class="c">##############################################################################</span>
<span class="c"># Join Materialization tests</span>
<span class="c">##############################################################################</span></div></div>
<div class="viewcode-block" id="TestJoinMaterialization"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestJoinMaterialization">[docs]</a><span class="k">class</span> <span class="nc">TestJoinMaterialization</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Unit tests for the JoinMaterialization class. &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestJoinMaterialization.setUp"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestJoinMaterialization.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxDiff</span> <span class="o">=</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="TestJoinMaterialization.test_simple_materialization"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestJoinMaterialization.test_simple_materialization">[docs]</a>    <span class="k">def</span> <span class="nf">test_simple_materialization</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Test simple join subset materialization. &quot;&quot;&quot;</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">TestData</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="s">&quot;join_subset_simple.orm&quot;</span><span class="p">)</span>
        <span class="n">loader</span> <span class="o">=</span> <span class="n">NormaLoader</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">model</span>

        <span class="n">sub</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;SUB&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">sub</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>

        <span class="c"># Execute transformation</span>
        <span class="n">trans</span> <span class="o">=</span> <span class="n">JoinMaterialization</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">execute</span><span class="p">())</span>

        <span class="c"># Confirm new constraints and new fact type are present</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>

        <span class="n">joinfact</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;SUB_join_fact&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">joinfact</span><span class="o">.</span><span class="n">arity</span><span class="p">(),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">joinfact</span><span class="p">,</span> <span class="n">JoinFactType</span><span class="p">))</span>

        <span class="c"># Check constraint covering</span>
        <span class="n">ahasb_0</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;AHasB&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ahasb_1</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;AHasB&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">bhasc_0</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;BHasC&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">bhasc_1</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;BHasC&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">ahasc_0</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;AHasC&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ahasc_1</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;AHasC&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">join_a</span> <span class="o">=</span> <span class="n">joinfact</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">join_b</span> <span class="o">=</span> <span class="n">joinfact</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">join_c</span> <span class="o">=</span> <span class="n">joinfact</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="c"># Check new equality constraints</span>
        <span class="n">join_eq1</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;join_eq&quot;</span><span class="p">)</span>
        <span class="n">join_eq2</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;join_eq2&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">join_eq1</span><span class="p">,</span> <span class="n">EqualityConstraint</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">join_eq2</span><span class="p">,</span> <span class="n">EqualityConstraint</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">join_eq1</span><span class="o">.</span><span class="n">subset</span><span class="p">,</span> <span class="p">[</span><span class="n">ahasb_0</span><span class="p">,</span> <span class="n">ahasb_1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">join_eq1</span><span class="o">.</span><span class="n">superset</span><span class="p">,</span> <span class="p">[</span><span class="n">join_a</span><span class="p">,</span> <span class="n">join_b</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">join_eq2</span><span class="o">.</span><span class="n">subset</span><span class="p">,</span> <span class="p">[</span><span class="n">bhasc_0</span><span class="p">,</span> <span class="n">bhasc_1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">join_eq2</span><span class="o">.</span><span class="n">superset</span><span class="p">,</span> <span class="p">[</span><span class="n">join_b</span><span class="p">,</span> <span class="n">join_c</span><span class="p">])</span>

        <span class="c"># Check modification of subset constraint</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">sub</span><span class="o">.</span><span class="n">superset</span><span class="p">,</span> <span class="p">[</span><span class="n">ahasc_0</span><span class="p">,</span> <span class="n">ahasc_1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">sub</span><span class="o">.</span><span class="n">subset</span><span class="p">,</span> <span class="p">[</span><span class="n">join_a</span><span class="p">,</span> <span class="n">join_c</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">sub</span><span class="o">.</span><span class="n">covers</span><span class="p">,</span> <span class="n">sub</span><span class="o">.</span><span class="n">subset</span> <span class="o">+</span> <span class="n">sub</span><span class="o">.</span><span class="n">superset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">sub</span><span class="o">.</span><span class="n">subset</span><span class="o">.</span><span class="n">join_path</span><span class="p">)</span>

        <span class="n">uniq_j1</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;join_uc&quot;</span><span class="p">)</span>
        <span class="n">uniq_j2</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;join_uc2&quot;</span><span class="p">)</span>
        <span class="n">uniq_j3</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;join_uc3&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">join_a</span><span class="o">.</span><span class="n">covered_by</span><span class="p">,</span> <span class="p">[</span><span class="n">sub</span><span class="p">,</span> <span class="n">join_eq1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">join_b</span><span class="o">.</span><span class="n">covered_by</span><span class="p">,</span> <span class="p">[</span><span class="n">uniq_j3</span><span class="p">,</span> <span class="n">join_eq1</span><span class="p">,</span> <span class="n">join_eq2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">join_c</span><span class="o">.</span><span class="n">covered_by</span><span class="p">,</span> <span class="p">[</span><span class="n">sub</span><span class="p">,</span> <span class="n">join_eq2</span><span class="p">])</span>

        <span class="c"># Check uniqueness constraints</span>
        <span class="n">uniq1</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;IUC1&quot;</span><span class="p">)</span>
        <span class="n">uniq2</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;IUC2&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">ahasb_0</span><span class="o">.</span><span class="n">covered_by</span><span class="p">,</span> <span class="p">[</span><span class="n">uniq1</span><span class="p">,</span> <span class="n">join_eq1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">ahasb_1</span><span class="o">.</span><span class="n">covered_by</span><span class="p">,</span> <span class="p">[</span><span class="n">uniq1</span><span class="p">,</span> <span class="n">uniq_j1</span><span class="p">,</span> <span class="n">join_eq1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">bhasc_0</span><span class="o">.</span><span class="n">covered_by</span><span class="p">,</span> <span class="p">[</span><span class="n">uniq2</span><span class="p">,</span> <span class="n">uniq_j2</span><span class="p">,</span> <span class="n">join_eq2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">bhasc_1</span><span class="o">.</span><span class="n">covered_by</span><span class="p">,</span> <span class="p">[</span><span class="n">uniq2</span><span class="p">,</span> <span class="n">join_eq2</span><span class="p">])</span>
        
        <span class="c"># Check correlation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">joinfact</span><span class="o">.</span><span class="n">corr</span><span class="p">[</span><span class="n">ahasb_0</span><span class="p">],</span> <span class="n">join_a</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">joinfact</span><span class="o">.</span><span class="n">corr</span><span class="p">[</span><span class="n">ahasb_1</span><span class="p">],</span> <span class="n">join_b</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">joinfact</span><span class="o">.</span><span class="n">corr</span><span class="p">[</span><span class="n">bhasc_0</span><span class="p">],</span> <span class="n">join_b</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">joinfact</span><span class="o">.</span><span class="n">corr</span><span class="p">[</span><span class="n">bhasc_1</span><span class="p">],</span> <span class="n">join_c</span><span class="p">)</span>

        <span class="c"># Check contents of added, removed, modified</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">modified</span><span class="p">,</span> <span class="p">[</span><span class="n">sub</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">added</span><span class="p">,</span> 
            <span class="p">[</span><span class="n">joinfact</span><span class="p">,</span> <span class="n">uniq_j1</span><span class="p">,</span> <span class="n">uniq_j2</span><span class="p">,</span> <span class="n">uniq_j3</span><span class="p">,</span> <span class="n">join_eq1</span><span class="p">,</span> <span class="n">join_eq2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">removed</span><span class="p">,</span> <span class="p">[])</span>
</div>
<div class="viewcode-block" id="TestJoinMaterialization.test_join_subset_covering_ref_roles"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestJoinMaterialization.test_join_subset_covering_ref_roles">[docs]</a>    <span class="k">def</span> <span class="nf">test_join_subset_covering_ref_roles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Test when the join fact type contains ref roles. &quot;&quot;&quot;</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">TestData</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="s">&quot;join_subset_ref_roles.orm&quot;</span><span class="p">)</span>
        <span class="n">loader</span> <span class="o">=</span> <span class="n">NormaLoader</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">model</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">JoinMaterialization</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">())</span>

        <span class="n">join_fact</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;SUB_join_fact&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">join_fact</span><span class="o">.</span><span class="n">arity</span><span class="p">())</span>

        <span class="n">obj_e</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">object_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;E&quot;</span><span class="p">)</span>
        <span class="n">join_role</span> <span class="o">=</span> <span class="n">join_fact</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">join_role</span><span class="o">.</span><span class="n">player</span><span class="p">,</span> <span class="n">obj_e</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">join_role</span><span class="p">,</span> <span class="n">obj_e</span><span class="o">.</span><span class="n">roles</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">join_role</span><span class="p">,</span> <span class="n">obj_e</span><span class="o">.</span><span class="n">ref_roles</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj_e</span><span class="o">.</span><span class="n">ref_roles</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">object_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">ref_roles</span><span class="p">,</span> <span class="p">[])</span>
</div>
<div class="viewcode-block" id="TestJoinMaterialization.test_join_subset_covering_both_join_roles"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestJoinMaterialization.test_join_subset_covering_both_join_roles">[docs]</a>    <span class="k">def</span> <span class="nf">test_join_subset_covering_both_join_roles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; This is a case that should be ignored: join subset covering</span>
<span class="sd">            both join roles. &quot;&quot;&quot;</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">TestData</span><span class="o">.</span><span class="n">path</span><span class="p">(</span><span class="s">&quot;join_subset_covering_both_join_roles.orm&quot;</span><span class="p">)</span>
        <span class="n">loader</span> <span class="o">=</span> <span class="n">NormaLoader</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">model</span>

        <span class="n">sub</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;SUB&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">sub</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">sub</span><span class="o">.</span><span class="n">superset</span><span class="o">.</span><span class="n">join_path</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>

        <span class="c"># Transformation should not affect anything</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">JoinMaterialization</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">fact_types</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="TestJoinMaterialization.test_join_fact_rollback_not_implemented"><a class="viewcode-back" href="../../test.html#test.TestTransformation.TestJoinMaterialization.test_join_fact_rollback_not_implemented">[docs]</a>    <span class="k">def</span> <span class="nf">test_join_fact_rollback_not_implemented</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">NotImplementedError</span><span class="p">):</span>
            <span class="n">JoinFactType</span><span class="p">()</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
</pre></div></div></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">ORMPY 0.1 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Matthew Nizol.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>